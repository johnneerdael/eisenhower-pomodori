(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const Ma="modulepreload",La=function(n){return"/"+n},lr={},as=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=La(c),c in lr)return;lr[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":Ma,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},ja=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>as(async()=>{const{default:s}=await Promise.resolve().then(()=>cs);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class wi extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Fa extends wi{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ur extends wi{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class hr extends wi{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ei;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(ei||(ei={}));var Ba=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};class $a{constructor(e,{headers:t={},customFetch:s,region:i=ei.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=ja(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ba(this,void 0,void 0,function*(){try{const{headers:i,method:r,body:o}=t;let a={},{region:c}=t;c||(c=this.region);const l=new URL(`${this.url}/${e}`);c&&c!=="any"&&(a["x-region"]=c,l.searchParams.set("forceFunctionRegion",c));let u;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const h=yield this.fetch(l.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:u}).catch(m=>{throw new Fa(m)}),d=h.headers.get("x-relay-error");if(d&&d==="true")throw new ur(h);if(!h.ok)throw new hr(h);let f=((s=h.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),p;return f==="application/json"?p=yield h.json():f==="application/octet-stream"?p=yield h.blob():f==="text/event-stream"?p=h:f==="multipart/form-data"?p=yield h.formData():p=yield h.text(),{data:p,error:null,response:h}}catch(i){return{data:null,error:i,response:i instanceof hr||i instanceof ur?i.context:void 0}}})}}var qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Va(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}),t}var Oe={},bi={},vn={},Ns={},wn={},bn={},qa=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Yt=qa();const Ua=Yt.fetch,Zr=Yt.fetch.bind(Yt),Qr=Yt.Headers,Wa=Yt.Request,za=Yt.Response,cs=Object.freeze(Object.defineProperty({__proto__:null,Headers:Qr,Request:Wa,Response:za,default:Zr,fetch:Ua},Symbol.toStringTag,{value:"Module"})),Ga=Va(cs);var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0});let Ha=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Tn.default=Ha;var eo=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(bn,"__esModule",{value:!0});const Ja=eo(Ga),Xa=eo(Tn);let Ka=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ja.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var o,a,c;let l=null,u=null,h=null,d=r.status,f=r.statusText;if(r.ok){if(this.method!=="HEAD"){const y=await r.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=y:u=JSON.parse(y))}const m=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),g=(a=r.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");m&&g&&g.length>1&&(h=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const m=await r.text();try{l=JSON.parse(m),Array.isArray(l)&&r.status===404&&(u=[],l=null,d=200,f="OK")}catch{r.status===404&&m===""?(d=204,f="No Content"):l={message:m}}if(l&&this.isMaybeSingle&&(!((c=l==null?void 0:l.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,d=200,f="OK"),l&&this.shouldThrowOnError)throw new Xa.default(l)}return{error:l,data:u,count:h,status:d,statusText:f}});return this.shouldThrowOnError||(i=i.catch(r=>{var o,a,c;return{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:`${(a=r==null?void 0:r.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=r==null?void 0:r.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};bn.default=Ka;var Ya=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(wn,"__esModule",{value:!0});const Za=Ya(bn);let Qa=class extends Za.default{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:r=i}={}){const o=r?`${r}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const r=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:r=!1,format:o="text"}={}){var a;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};wn.default=Qa;var ec=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ns,"__esModule",{value:!0});const tc=ec(wn);let sc=class extends tc.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let r="";i==="plain"?r="pl":i==="phrase"?r="ph":i==="websearch"&&(r="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${r}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ns.default=sc;var nc=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(vn,"__esModule",{value:!0});const ys=nc(Ns);let ic=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let r=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!r?"":(a==='"'&&(r=!r),a)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new ys.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new ys.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:r=!0}={}){const o="POST",a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){const l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new ys.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new ys.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new ys.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};vn.default=ic;var kn={},Sn={};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.version=void 0;Sn.version="0.0.0-automated";Object.defineProperty(kn,"__esModule",{value:!0});kn.DEFAULT_HEADERS=void 0;const rc=Sn;kn.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${rc.version}`};var to=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(bi,"__esModule",{value:!0});const oc=to(vn),ac=to(Ns),cc=kn;let lc=class so{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},cc.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new oc.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new so(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:r}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let c;s||i?(o=s?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(o="POST",c=t);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new ac.default({method:o,url:a,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};bi.default=lc;var ls=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.PostgrestError=Oe.PostgrestBuilder=Oe.PostgrestTransformBuilder=Oe.PostgrestFilterBuilder=Oe.PostgrestQueryBuilder=Oe.PostgrestClient=void 0;const no=ls(bi);Oe.PostgrestClient=no.default;const io=ls(vn);Oe.PostgrestQueryBuilder=io.default;const ro=ls(Ns);Oe.PostgrestFilterBuilder=ro.default;const oo=ls(wn);Oe.PostgrestTransformBuilder=oo.default;const ao=ls(bn);Oe.PostgrestBuilder=ao.default;const co=ls(Tn);Oe.PostgrestError=co.default;var uc=Oe.default={PostgrestClient:no.default,PostgrestQueryBuilder:io.default,PostgrestFilterBuilder:ro.default,PostgrestTransformBuilder:oo.default,PostgrestBuilder:ao.default,PostgrestError:co.default};const{PostgrestClient:hc,PostgrestQueryBuilder:lg,PostgrestFilterBuilder:ug,PostgrestTransformBuilder:hg,PostgrestBuilder:dg,PostgrestError:fg}=uc;function dc(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const fc=dc(),pc="2.11.15",mc=`realtime-js/${pc}`,gc="1.0.0",lo=1e4,_c=1e3;var ws;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ws||(ws={}));var we;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(we||(we={}));var We;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(We||(We={}));var ti;(function(n){n.websocket="websocket"})(ti||(ti={}));var Ot;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ot||(Ot={}));class yc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),r=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+i));o=o+i;const c=s.decode(e.slice(o,o+r));o=o+r;const l=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}}class uo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Q;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Q||(Q={}));const dr=(n,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((r,o)=>(r[o]=vc(o,n,e,i),r),{})},vc=(n,e,t,s)=>{const i=e.find(a=>a.name===n),r=i==null?void 0:i.type,o=t[n];return r&&!s.includes(r)?ho(r,o):si(o)},ho=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return kc(e,t)}switch(n){case Q.bool:return wc(e);case Q.float4:case Q.float8:case Q.int2:case Q.int4:case Q.int8:case Q.numeric:case Q.oid:return bc(e);case Q.json:case Q.jsonb:return Tc(e);case Q.timestamp:return Sc(e);case Q.abstime:case Q.date:case Q.daterange:case Q.int4range:case Q.int8range:case Q.money:case Q.reltime:case Q.text:case Q.time:case Q.timestamptz:case Q.timetz:case Q.tsrange:case Q.tstzrange:return si(e);default:return si(e)}},si=n=>n,wc=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},bc=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Tc=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},kc=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let r;const o=n.slice(1,t);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>ho(e,a))}return n},Sc=n=>typeof n=="string"?n.replace(" ","T"):n,fo=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class zn{constructor(e,t,s={},i=lo){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var fr;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(fr||(fr={}));class bs{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=bs.syncState(this.state,i,r,o),this.pendingDiffs.forEach(c=>{this.state=bs.syncDiff(this.state,c,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},i=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=bs.syncDiff(this.state,i,r,o),a())}),this.onJoin((i,r,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:r,newPresences:o})}),this.onLeave((i,r,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const r=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(r,(l,u)=>{o[l]||(c[l]=u)}),this.map(o,(l,u)=>{const h=r[l];if(h){const d=u.map(g=>g.presence_ref),f=h.map(g=>g.presence_ref),p=u.filter(g=>f.indexOf(g.presence_ref)<0),m=h.filter(g=>d.indexOf(g.presence_ref)<0);p.length>0&&(a[l]=p),m.length>0&&(c[l]=m)}else a[l]=u}),this.syncDiff(r,{joins:a,leaves:c},s,i)}static syncDiff(e,t,s,i){const{joins:r,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,(a,c)=>{var l;const u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){const h=e[a].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}s(a,u,c)}),this.map(o,(a,c)=>{let l=e[a];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=l,i(a,l,c),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var pr;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(pr||(pr={}));var mr;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(mr||(mr={}));var it;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(it||(it={}));class Ti{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=we.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new zn(this,We.join,this.params,this.timeout),this.rejoinTimer=new uo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=we.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=we.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=we.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=we.errored,this.rejoinTimer.scheduleTimeout())}),this._on(We.reply,{},(i,r)=>{this._trigger(this._replyEventName(r),i)}),this.presence=new bs(this),this.broadcastEndpointURL=fo(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==we.closed){const{config:{broadcast:r,presence:o,private:a}}=this.params;this._onError(u=>e==null?void 0:e(it.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(it.CLOSED));const c={},l={broadcast:r,presence:o,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&i!==void 0?i:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(it.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d==null?void 0:d.length)!==null&&h!==void 0?h:0,p=[];for(let m=0;m<f;m++){const g=d[m],{filter:{event:y,schema:k,table:b,filter:S}}=g,_=u&&u[m];if(_&&_.event===y&&_.schema===k&&_.table===b&&_.filter===S)p.push(Object.assign(Object.assign({},g),{id:_.id}));else{this.unsubscribe(),this.state=we.errored,e==null||e(it.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(it.SUBSCRIBED);return}}).receive("error",u=>{this.state=we.errored,e==null||e(it.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(it.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=l.body)===null||i===void 0?void 0:i.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&r("ok"),l.receive("ok",()=>r("ok")),l.receive("error",()=>r("error")),l.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=we.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(We.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new zn(this,We.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const i=new AbortController,r=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new zn(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=We;if(s&&[a,c,l,u].indexOf(o)>=0&&s!==this._joinRef())return;let d=this._onMessage(o,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var p,m,g;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((g=(m=f.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(f=>f.callback(d,s)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var p,m,g,y,k,b;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const S=f.id,_=(p=f.filter)===null||p===void 0?void 0:p.event;return S&&((m=t.ids)===null||m===void 0?void 0:m.includes(S))&&(_==="*"||(_==null?void 0:_.toLocaleLowerCase())===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const S=(k=(y=f==null?void 0:f.filter)===null||y===void 0?void 0:y.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return S==="*"||S===((b=t==null?void 0:t.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:m,table:g,commit_timestamp:y,type:k,errors:b}=p;d=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:y,eventType:k,new:{},old:{},errors:b}),this._getPayloadRecords(p))}f.callback(d,s)})}_isClosed(){return this.state===we.closed}_isJoined(){return this.state===we.joined}_isJoining(){return this.state===we.joining}_isLeaving(){return this.state===we.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var r;return!(((r=i.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===s&&Ti.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(We.close,{},e)}_onError(e){this._on(We.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=we.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=dr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=dr(e.columns,e.old_record)),t}}const gr=()=>{},Cc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ec{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=lo,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=gr,this.ref=0,this.logger=gr,this.conn=null,this.sendBuffer=[],this.serializer=new yc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=r=>{let o;return r?o=r:typeof fetch>"u"?o=(...a)=>as(async()=>{const{default:c}=await Promise.resolve().then(()=>cs);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${ti.websocket}`,this.httpEndpoint=fo(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(r,o)=>o(JSON.stringify(r)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new uo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=fc),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:gc}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ws.connecting:return Ot.Connecting;case ws.open:return Ot.Open;case ws.closing:return Ot.Closing;default:return Ot.Closed}}isConnected(){return this.connectionState()===Ot.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(r=>r.topic===s);if(i)return i;{const r=new Ti(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:s,payload:i,ref:r}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${s} (${r})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:mc};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(We.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(_c,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:r,ref:o}=t;s==="phoenix"&&i==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${s} ${i} ${o&&"("+o+")"||""}`,r),Array.from(this.channels).filter(a=>a._isMember(s)).forEach(a=>a._trigger(i,r,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(We.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Cc],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class ki extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function me(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ac extends ki{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ni extends ki{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var xc=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const po=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>as(async()=>{const{default:s}=await Promise.resolve().then(()=>cs);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Oc=()=>xc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield as(()=>Promise.resolve().then(()=>cs),void 0)).Response:Response}),ii=n=>{if(Array.isArray(n))return n.map(t=>ii(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[i]=ii(s)}),e};var Mt=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const Gn=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ic=(n,e,t)=>Mt(void 0,void 0,void 0,function*(){const s=yield Oc();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{e(new Ac(Gn(i),n.status||500))}).catch(i=>{e(new ni(Gn(i),i))}):e(new ni(Gn(n),n))}),Nc=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),t))};function Rs(n,e,t,s,i,r){return Mt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Nc(e,s,i,r)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Ic(c,a,s))})})}function rn(n,e,t,s){return Mt(this,void 0,void 0,function*(){return Rs(n,"GET",e,t,s)})}function mt(n,e,t,s,i){return Mt(this,void 0,void 0,function*(){return Rs(n,"POST",e,s,i,t)})}function Rc(n,e,t,s,i){return Mt(this,void 0,void 0,function*(){return Rs(n,"PUT",e,s,i,t)})}function Pc(n,e,t,s){return Mt(this,void 0,void 0,function*(){return Rs(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function mo(n,e,t,s,i){return Mt(this,void 0,void 0,function*(){return Rs(n,"DELETE",e,s,i,t)})}var xe=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const Dc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_r={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Mc{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=po(i)}uploadOrUpdate(e,t,s,i){return xe(this,void 0,void 0,function*(){try{let r;const o=Object.assign(Object.assign({},_r),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),c&&r.append("metadata",this.encodeMetadata(c)),r.append("",s)):typeof FormData<"u"&&s instanceof FormData?(r=s,r.append("cacheControl",o.cacheControl),c&&r.append("metadata",this.encodeMetadata(c))):(r=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:r,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),d=yield h.json();return h.ok?{data:{path:l,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(r){if(me(r))return{data:null,error:r};throw r}})}upload(e,t,s){return xe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return xe(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),o=this._getFinalPath(r),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:_r.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u}),d=yield h.json();return h.ok?{data:{path:r,fullPath:d.Key},error:null}:{data:null,error:d}}catch(c){if(me(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return xe(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const r=yield mt(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),o=new URL(this.url+r.url),a=o.searchParams.get("token");if(!a)throw new ki("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(me(s))return{data:null,error:s};throw s}})}update(e,t,s){return xe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return xe(this,void 0,void 0,function*(){try{return{data:yield mt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}})}copy(e,t,s){return xe(this,void 0,void 0,function*(){try{return{data:{path:(yield mt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return xe(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),r=yield mt(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${o}`)},{data:r,error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return xe(this,void 0,void 0,function*(){try{const i=yield mt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${r}`):null})),error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}})}download(e,t){return xe(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=r?`?${r}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield rn(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(me(a))return{data:null,error:a};throw a}})}info(e){return xe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield rn(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ii(s),error:null}}catch(s){if(me(s))return{data:null,error:s};throw s}})}exists(e){return xe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Pc(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(me(s)&&s instanceof ni){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],r=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";r!==""&&i.push(r);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&i.push(c);let l=i.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${l}`)}}}remove(e){return xe(this,void 0,void 0,function*(){try{return{data:yield mo(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(me(t))return{data:null,error:t};throw t}})}list(e,t,s){return xe(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Dc),t),{prefix:e||""});return{data:yield mt(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(me(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Lc="2.7.1",jc={"X-Client-Info":`storage-js/${Lc}`};var Vt=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};class Fc{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},jc),t),this.fetch=po(s)}listBuckets(){return Vt(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(me(e))return{data:null,error:e};throw e}})}getBucket(e){return Vt(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(me(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Vt(this,void 0,void 0,function*(){try{return{data:yield mt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(me(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Vt(this,void 0,void 0,function*(){try{return{data:yield Rc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(me(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Vt(this,void 0,void 0,function*(){try{return{data:yield mt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(me(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Vt(this,void 0,void 0,function*(){try{return{data:yield mo(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(me(t))return{data:null,error:t};throw t}})}}class Bc extends Fc{constructor(e,t={},s){super(e,t,s)}from(e){return new Mc(this.url,this.headers,e,this.fetch)}}const $c="2.50.5";let vs="";typeof Deno<"u"?vs="deno":typeof document<"u"?vs="web":typeof navigator<"u"&&navigator.product==="ReactNative"?vs="react-native":vs="node";const Vc={"X-Client-Info":`supabase-js-${vs}/${$c}`},qc={headers:Vc},Uc={schema:"public"},Wc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},zc={};var Gc=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const Hc=n=>{let e;return n?e=n:typeof fetch>"u"?e=Zr:e=fetch,(...t)=>e(...t)},Jc=()=>typeof Headers>"u"?Qr:Headers,Xc=(n,e,t)=>{const s=Hc(t),i=Jc();return(r,o)=>Gc(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let l=new i(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(r,Object.assign(Object.assign({},o),{headers:l}))})};var Kc=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};function Yc(n){return n.endsWith("/")?n:n+"/"}function Zc(n,e){var t,s;const{db:i,auth:r,realtime:o,global:a}=n,{db:c,auth:l,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},l),r),realtime:Object.assign(Object.assign({},u),o),global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>Kc(this,void 0,void 0,function*(){return""})};return n.accessToken?d.accessToken=n.accessToken:delete d.accessToken,d}const go="2.70.0",Gt=30*1e3,ri=3,Hn=ri*Gt,Qc="http://localhost:9999",el="supabase.auth.token",tl={"X-Client-Info":`gotrue-js/${go}`},oi="X-Supabase-Api-Version",_o={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,nl=6e5;class Si extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function V(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class il extends Si{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function rl(n){return V(n)&&n.name==="AuthApiError"}class yo extends Si{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class bt extends Si{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class pt extends bt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ol(n){return V(n)&&n.name==="AuthSessionMissingError"}class Hs extends bt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Js extends bt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Xs extends bt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function al(n){return V(n)&&n.name==="AuthImplicitGrantRedirectError"}class yr extends bt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ai extends bt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Jn(n){return V(n)&&n.name==="AuthRetryableFetchError"}class vr extends bt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ts extends bt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),wr=` 	
\r=`.split(""),cl=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<wr.length;e+=1)n[wr[e].charCodeAt(0)]=-2;for(let e=0;e<on.length;e+=1)n[on[e].charCodeAt(0)]=e;return n})();function br(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(on[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(on[s]),e.queuedBits-=6}}function vo(n,e,t){const s=cl[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Tr(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},r=o=>{hl(o,s,t)};for(let o=0;o<n.length;o+=1)vo(n.charCodeAt(o),i,r);return e.join("")}function ll(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function ul(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}ll(s,e)}}function hl(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function dl(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)vo(n.charCodeAt(i),t,s);return new Uint8Array(e)}function fl(n){const e=[];return ul(n,t=>e.push(t)),new Uint8Array(e)}function pl(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return n.forEach(i=>br(i,t,s)),br(null,t,s),e.join("")}function ml(n){return Math.round(Date.now()/1e3)+n}function gl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Ue=()=>typeof window<"u"&&typeof document<"u",At={tested:!1,writable:!1},ks=()=>{if(!Ue())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(At.tested)return At.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),At.tested=!0,At.writable=!0}catch{At.tested=!0,At.writable=!1}return At.writable};function _l(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,r)=>{e[r]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const wo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>as(async()=>{const{default:s}=await Promise.resolve().then(()=>cs);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},yl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",bo=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ks=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ys=async(n,e)=>{await n.removeItem(e)};class Cn{constructor(){this.promise=new Cn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Cn.promiseConstructor=Promise;function Xn(n){const e=n.split(".");if(e.length!==3)throw new Ts("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!sl.test(e[s]))throw new Ts("JWT not in base64url format");return{header:JSON.parse(Tr(e[0])),payload:JSON.parse(Tr(e[1])),signature:dl(e[2]),raw:{header:e[0],payload:e[1]}}}async function vl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function wl(n,e){return new Promise((s,i)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await n(r);if(!e(r,null,o)){s(o);return}}catch(o){if(!e(r,o)){i(o);return}}})()})}function bl(n){return("0"+n.toString(16)).substr(-2)}function Tl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let r=0;r<56;r++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,bl).join("")}async function kl(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(r=>String.fromCharCode(r)).join("")}async function Sl(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await kl(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function qt(n,e,t=!1){const s=Tl();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await bo(n,`${e}-code-verifier`,i);const r=await Sl(s);return[r,s===r?"plain":"s256"]}const Cl=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function El(n){const e=n.headers.get(oi);if(!e||!e.match(Cl))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Al(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function xl(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ol=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ut(n){if(!Ol.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Il=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};const xt=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Nl=[502,503,504];async function kr(n){var e;if(!yl(n))throw new ai(xt(n),0);if(Nl.includes(n.status))throw new ai(xt(n),n.status);let t;try{t=await n.json()}catch(r){throw new yo(xt(r),r)}let s;const i=El(n);if(i&&i.getTime()>=_o["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new vr(xt(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new pt}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new vr(xt(t),n.status,t.weak_password.reasons);throw new il(xt(t),n.status||500,s)}const Rl=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function W(n,e,t,s){var i;const r=Object.assign({},s==null?void 0:s.headers);r[oi]||(r[oi]=_o["2024-01-01"].name),s!=null&&s.jwt&&(r.Authorization=`Bearer ${s.jwt}`);const o=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Pl(n,e,t+a,{headers:r,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Pl(n,e,t,s,i,r){const o=Rl(e,s,i,r);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new ai(xt(c),0)}if(a.ok||await kr(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(c){await kr(c)}}function nt(n){var e;let t=null;jl(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=ml(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function Sr(n){const e=nt(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function _t(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Dl(n){return{data:n,error:null}}function Ml(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:r}=n,o=Il(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:r},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function Ll(n){return n}function jl(n){return n.access_token&&n.refresh_token&&n.expires_in}const Kn=["global","local","others"];var Fl=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};class Bl{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=wo(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Kn[0]){if(Kn.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Kn.join(", ")}`);try{return await W(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(V(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await W(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_t})}catch(s){if(V(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Fl(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await W(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Ml,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(V(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await W(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_t})}catch(t){if(V(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,r,o,a,c;try{const l={nextPage:null,lastPage:0,total:0},u=await W(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:Ll});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);l[`${g}Page`]=m}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(V(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Ut(e);try{return await W(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_t})}catch(t){if(V(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ut(e);try{return await W(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_t})}catch(s){if(V(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Ut(e);try{return await W(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_t})}catch(s){if(V(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Ut(e.userId);try{const{data:t,error:s}=await W(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(V(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ut(e.userId),Ut(e.id);try{return{data:await W(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(V(t))return{data:null,error:t};throw t}}}const $l={getItem:n=>ks()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{ks()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{ks()&&globalThis.localStorage.removeItem(n)}};function Cr(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Vl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Wt={debug:!!(globalThis&&ks()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class To extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ql extends To{}async function Ul(n,e,t){Wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Wt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{Wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw Wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new ql(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Wt.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Vl();const Wl={url:Qc,storageKey:el,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:tl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Er(n,e,t){return await t()}class Es{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Es.nextInstanceID,Es.nextInstanceID+=1,this.instanceID>0&&Ue()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Wl),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Bl({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=wo(i.fetch),this.lock=i.lock||Er,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Ue()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ul:this.lock=Er,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:ks()?this.storage=$l:(this.memoryStorage={},this.storage=Cr(this.memoryStorage)):(this.memoryStorage={},this.storage=Cr(this.memoryStorage)),Ue()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${go}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=_l(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Ue()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:r}=await this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),al(r)){const c=(e=r.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:r}}return await this._removeSession(),{error:r}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return V(t)?{error:t}:{error:new yo("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const r=await W(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:nt}),{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(V(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,i;try{let r;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await qt(this.storage,this.storageKey)),r=await W(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},xform:nt})}else if("phone"in e){const{phone:u,password:h,options:d}=e;r=await W(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(i=d==null?void 0:d.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:nt})}else throw new Js("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(V(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:o,options:a}=e;t=await W(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Sr})}else if("phone"in e){const{phone:r,password:o,options:a}=e;t=await W(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Sr})}else throw new Js("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Hs}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,r,o,a,c,l,u,h,d,f;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:g,wallet:y,statement:k,options:b}=e;let S;if(Ue())if(typeof y=="object")S=y;else{const w=window;if("solana"in w&&typeof w.solana=="object"&&("signIn"in w.solana&&typeof w.solana.signIn=="function"||"signMessage"in w.solana&&typeof w.solana.signMessage=="function"))S=w.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=y}const _=new URL((t=b==null?void 0:b.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in S&&S.signIn){const w=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),k?{statement:k}:null));let T;if(Array.isArray(w)&&w[0]&&typeof w[0]=="object")T=w[0];else if(w&&typeof w=="object"&&"signedMessage"in w&&"signature"in w)T=w;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)p=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),m=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${_.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(i=(s=b==null?void 0:b.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((r=b==null?void 0:b.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b==null?void 0:b.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((h=(u=b==null?void 0:b.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...b.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const w=await S.signMessage(new TextEncoder().encode(p),"utf8");if(!w||!(w instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=w}}try{const{data:g,error:y}=await W(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:pl(m)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:nt});if(y)throw y;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Hs}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:y})}catch(g){if(V(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await Ks(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:r,error:o}=await W(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:nt});if(await Ys(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new Hs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:i??null}),error:o})}catch(r){if(V(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:r,nonce:o}=e,a=await W(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:nt}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Hs}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,r,o;try{if("email"in e){const{email:a,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await qt(this.storage,this.storageKey));const{error:h}=await W(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:l,error:u}=await W(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Js("You must provide either an email or phone number.")}catch(a){if(V(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let i,r;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await W(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:nt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,l=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(V(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let r=null,o=null;return this.flowType==="pkce"&&([r,o]=await qt(this.storage,this.storageKey)),await W(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:o}),headers:this.headers,xform:Dl})}catch(r){if(V(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new pt;const{error:i}=await W(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(V(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:r}=e,{error:o}=await W(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:i,options:r}=e,{data:o,error:a}=await W(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Js("You must provide either an email or phone number and a type")}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ks(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Hn:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await W(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_t}):await this._useSession(async t=>{var s,i,r;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new pt}:await W(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0,xform:_t})})}catch(t){if(V(t))return ol(t)&&(await this._removeSession(),await Ys(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new pt;const o=i.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await qt(this.storage,this.storageKey));const{data:l,error:u}=await W(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:_t});if(u)throw u;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(V(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new pt;const t=Date.now()/1e3;let s=t,i=!0,r=null;const{payload:o}=Xn(e.access_token);if(o.exp&&(s=o.exp,i=s<=t),i){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;r={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(V(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new pt;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Ue())throw new Xs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Xs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new yr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Xs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new yr("No code detected.");const{data:k,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:o,expires_in:a,expires_at:c,token_type:l}=e;if(!r||!a||!o||!l)throw new Xs("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;c&&(d=parseInt(c));const f=d-u;f*1e3<=Gt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const p=d-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,u);const{data:m,error:g}=await this._getUser(r);if(g)throw g;const y={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:h,expires_at:d,refresh_token:o,token_type:l,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(s){if(V(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ks(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:r}=t;if(r)return{error:r};const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(rl(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Ys(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=gl(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:r},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await qt(this.storage,this.storageKey,!0));try{return await W(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(V(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(V(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async r=>{var o,a,c,l,u;const{data:h,error:d}=r;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await W(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return Ue()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(V(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:r,error:o}=t;if(o)throw o;return await W(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(V(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await wl(async i=>(i>0&&await vl(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await W(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:nt})),(i,r)=>{const o=200*Math.pow(2,i);return r&&Jn(r)&&Date.now()+o-s<Gt})}catch(s){if(this._debug(t,"error",s),V(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Ue()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ks(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Hn;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Hn}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:r}=await this._callRefreshToken(s.refresh_token);r&&(console.error(r),Jn(r)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",r),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new pt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Cn;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new pt;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={session:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(i,"error",r),V(r)){const o={session:null,error:r};return Jn(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){r.push(c)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await bo(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ys(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ue()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Gt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/Gt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Gt}ms, refresh threshold is ${ri} ticks`),i<=ri&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof To)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ue()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[r,o]=await qt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(s!=null&&s.queryParams){const r=new URLSearchParams(s.queryParams);i.push(r.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await W(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(V(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:r,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await W(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(V(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:o,error:a}=await W(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(V(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await W(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(V(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),r=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Xn(i.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+nl>Date.now()))return s;const{data:i,error:r}=await W(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;if(!i.keys||i.keys.length===0)throw new Ts("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),s=i.keys.find(o=>o.kid===e),!s)throw new Ts("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:f,error:p}=await this.getSession();if(p||!f.session)return{data:null,error:p};s=f.session.access_token}const{header:i,payload:r,signature:o,raw:{header:a,payload:c}}=Xn(s);if(Al(r.exp),!i.kid||i.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:r,header:i,signature:o},error:null}}const l=xl(i.alg),u=await this.fetchJwk(i.kid,t),h=await crypto.subtle.importKey("jwk",u,l,!0,["verify"]);if(!await crypto.subtle.verify(l,h,o,fl(`${a}.${c}`)))throw new Ts("Invalid JWT signature");return{data:{claims:r,header:i,signature:o},error:null}}catch(s){if(V(s))return{data:null,error:s};throw s}}}Es.nextInstanceID=0;const zl=Es;class Gl extends zl{constructor(e){super(e)}}var Hl=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};class Jl{constructor(e,t,s){var i,r,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Yc(e),c=new URL(a);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const l=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:Uc,realtime:zc,auth:Object.assign(Object.assign({},Wc),{storageKey:l}),global:qc},h=Zc(s??{},u);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(r=h.global.headers)!==null&&r!==void 0?r:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=Xc(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new hc(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new $a(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Bc(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Hl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:r,flowType:o,lock:a,debug:c},l,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Gl({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),l),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:o,lock:a,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Ec(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Xl=(n,e,t)=>new Jl(n,e,t);/*! Capacitor: https://capacitorjs.com/ - MIT License */var Zt;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Zt||(Zt={}));class Yn extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const Kl=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Yl=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},s=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:Kl(n),r=()=>i()!=="web",o=h=>{const d=l.get(h);return!!(d!=null&&d.platforms.has(i())||a(h))},a=h=>{var d;return(d=t.PluginHeaders)===null||d===void 0?void 0:d.find(f=>f.name===h)},c=h=>n.console.error(h),l=new Map,u=(h,d={})=>{const f=l.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const p=i(),m=a(h);let g;const y=async()=>(!g&&p in d?g=typeof d[p]=="function"?g=await d[p]():g=d[p]:e!==null&&!g&&"web"in d&&(g=typeof d.web=="function"?g=await d.web():g=d.web),g),k=(v,A)=>{var E,x;if(m){const C=m==null?void 0:m.methods.find(O=>A===O.name);if(C)return C.rtype==="promise"?O=>t.nativePromise(h,A.toString(),O):(O,I)=>t.nativeCallback(h,A.toString(),O,I);if(v)return(E=v[A])===null||E===void 0?void 0:E.bind(v)}else{if(v)return(x=v[A])===null||x===void 0?void 0:x.bind(v);throw new Yn(`"${h}" plugin is not implemented on ${p}`,Zt.Unimplemented)}},b=v=>{let A;const E=(...x)=>{const C=y().then(O=>{const I=k(O,v);if(I){const D=I(...x);return A=D==null?void 0:D.remove,D}else throw new Yn(`"${h}.${v}()" is not implemented on ${p}`,Zt.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return E.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(E,"name",{value:v,writable:!1,configurable:!1}),E},S=b("addListener"),_=b("removeListener"),w=(v,A)=>{const E=S({eventName:v},A),x=async()=>{const O=await E;_({eventName:v,callbackId:O},A)},C=new Promise(O=>E.then(()=>O({remove:x})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await x()},C},T=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return m?w:S;case"removeListener":return _;default:return b(A)}}});return s[h]=T,l.set(h,{name:h,proxy:T,platforms:new Set([...Object.keys(d),...m?[p]:[]])}),T};return t.convertFileSrc||(t.convertFileSrc=h=>h),t.getPlatform=i,t.handleError=c,t.isNativePlatform=r,t.isPluginAvailable=o,t.registerPlugin=u,t.Exception=Yn,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},Zl=n=>n.Capacitor=Yl(n),ci=Zl(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ci=ci.registerPlugin;class ko{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,t);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const i=this.listeners[e];if(!i){if(s){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}i.forEach(r=>r(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new ci.Exception(e,Zt.Unimplemented)}unavailable(e="not available"){return new ci.Exception(e,Zt.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(s=>{this.notifyListeners(e,s)}))}}const Ar=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),xr=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ql extends ko{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,r]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=xr(i).trim(),r=xr(r).trim(),t[i]=r}),t}async setCookie(e){try{const t=Ar(e.key),s=Ar(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${r}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Ci("CapacitorCookies",{web:()=>new Ql});const eu=async n=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>t(i),s.readAsDataURL(n)}),tu=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,r,o)=>(i[r]=n[e[o]],i),{})},su=(n,e=!0)=>n?Object.entries(n).reduce((s,i)=>{const[r,o]=i;let a,c;return Array.isArray(o)?(c="",o.forEach(l=>{a=e?encodeURIComponent(l):l,c+=`${r}=${a}&`}),c.slice(0,-1)):(a=e?encodeURIComponent(o):o,c=`${r}=${a}`),`${s}&${c}`},"").substr(1):null,nu=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=tu(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const r=new URLSearchParams;for(const[o,a]of Object.entries(n.data||{}))r.set(o,a);t.body=r.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const r=new FormData;if(n.data instanceof FormData)n.data.forEach((a,c)=>{r.append(c,a)});else for(const a of Object.keys(n.data))r.append(a,n.data[a]);t.body=r;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class iu extends ko{async request(e){const t=nu(e,e.webFetchExtra),s=su(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,r=await fetch(i,t),o=r.headers.get("content-type")||"";let{responseType:a="text"}=r.ok?e:{};o.includes("application/json")&&(a="json");let c,l;switch(a){case"arraybuffer":case"blob":l=await r.blob(),c=await eu(l);break;case"json":c=await r.json();break;case"document":case"text":default:c=await r.text()}const u={};return r.headers.forEach((h,d)=>{u[d]=h}),{data:c,headers:u,status:r.status,url:r.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Ci("CapacitorHttp",{web:()=>new iu});const ru=Ci("App",{web:()=>as(()=>import("./web-CLZ8XKC8.js"),[]).then(n=>new n.AppWeb)}),So="15.1.22",Or=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),Ir=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),li=(n,e)=>({startTime:e,type:"setValue",value:n}),Co=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Eo=(n,e,{startTime:t,target:s,timeConstant:i})=>s+(e-s)*Math.exp((t-n)/i),Jt=n=>n.type==="exponentialRampToValue",an=n=>n.type==="linearRampToValue",gt=n=>Jt(n)||an(n),Ei=n=>n.type==="setValue",rt=n=>n.type==="setValueCurve",cn=(n,e,t,s)=>{const i=n[e];return i===void 0?s:gt(i)||Ei(i)?i.value:rt(i)?i.values[i.values.length-1]:Eo(t,cn(n,e-1,i.startTime,s),i)},Nr=(n,e,t,s,i)=>t===void 0?[s.insertTime,i]:gt(t)?[t.endTime,t.value]:Ei(t)?[t.startTime,t.value]:rt(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,cn(n,e-1,t.startTime,i)],ui=n=>n.type==="cancelAndHold",hi=n=>n.type==="cancelScheduledValues",ft=n=>ui(n)||hi(n)?n.cancelTime:Jt(n)||an(n)?n.endTime:n.startTime,Rr=(n,e,t,{endTime:s,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(s-e)):0,Pr=(n,e,t,{endTime:s,value:i})=>t+(n-e)/(s-e)*(i-t),ou=(n,e)=>{const t=Math.floor(e),s=Math.ceil(e);return t===s?n[t]:(1-(e-t))*n[t]+(1-(s-e))*n[s]},au=(n,{duration:e,startTime:t,values:s})=>{const i=(n-t)/e*(s.length-1);return ou(s,i)},Zs=n=>n.type==="setTarget";class cu{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=ft(e);if(ui(e)||hi(e)){const s=this._automationEvents.findIndex(r=>hi(e)&&rt(r)?r.startTime+r.duration>=t:ft(r)>=t),i=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),ui(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&gt(i)){if(r!==void 0&&Zs(r))throw new Error("The internal list is malformed.");const o=r===void 0?i.insertTime:rt(r)?r.startTime+r.duration:ft(r),a=r===void 0?this._defaultValue:rt(r)?r.values[r.values.length-1]:r.value,c=Jt(i)?Rr(t,o,a,i):Pr(t,o,a,i),l=Jt(i)?Or(c,t,this._currenTime):Ir(c,t,this._currenTime);this._automationEvents.push(l)}if(r!==void 0&&Zs(r)&&this._automationEvents.push(li(this.getValue(t),t)),r!==void 0&&rt(r)&&r.startTime+r.duration>t){const o=t-r.startTime,a=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=r.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=r.values[h-1]*(1-d)+r.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Co(u,r.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>ft(o)>t),i=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(i!==void 0&&rt(i)&&ft(i)+i.duration>t)return!1;const r=Jt(e)?Or(e.value,e.endTime,this._currenTime):an(e)?Ir(e.value,t,this._currenTime):e;if(s===-1)this._automationEvents.push(r);else{if(rt(e)&&t+e.duration>ft(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,r)}}return!0}flush(e){const t=this._automationEvents.findIndex(s=>ft(s)>e);if(t>1){const s=this._automationEvents.slice(t-1),i=s[0];Zs(i)&&s.unshift(li(cn(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=s}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>ft(o)>e),s=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,r=this._automationEvents[i];if(r!==void 0&&Zs(r)&&(s===void 0||!gt(s)||s.insertTime>e))return Eo(e,cn(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&Ei(r)&&(s===void 0||!gt(s)))return r.value;if(r!==void 0&&rt(r)&&(s===void 0||!gt(s)||r.startTime+r.duration>e))return e<r.startTime+r.duration?au(e,r):r.values[r.values.length-1];if(r!==void 0&&gt(r)&&(s===void 0||!gt(s)))return r.value;if(s!==void 0&&Jt(s)){const[o,a]=Nr(this._automationEvents,i,r,s,this._defaultValue);return Rr(e,o,a,s)}if(s!==void 0&&an(s)){const[o,a]=Nr(this._automationEvents,i,r,s,this._defaultValue);return Pr(e,o,a,s)}return this._defaultValue}}const lu=n=>({cancelTime:n,type:"cancelAndHold"}),uu=n=>({cancelTime:n,type:"cancelScheduledValues"}),hu=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),du=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),fu=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),pu=()=>new DOMException("","AbortError"),mu=n=>(e,t,[s,i,r],o)=>{n(e[i],[t,s,r],a=>a[0]===t&&a[1]===s,o)},gu=n=>(e,t,s)=>{const i=[];for(let r=0;r<s.numberOfInputs;r+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},_u=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Qt=new WeakSet,Ao=new WeakMap,Ai=new WeakMap,xo=new WeakMap,xi=new WeakMap,En=new WeakMap,Oo=new WeakMap,di=new WeakMap,fi=new WeakMap,pi=new WeakMap,Io={construct(){return Io}},yu=n=>{try{const e=new Proxy(n,Io);new e}catch{return!1}return!0},Dr=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Mr=(n,e)=>{const t=[];let s=n.replace(/^[\s]+/,""),i=s.match(Dr);for(;i!==null;){const r=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(o),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(Dr)}return[t.join(";"),s]},Lr=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},jr=n=>{if(!yu(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},vu=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{let f=0;return(p,m,g={credentials:"omit"})=>{const y=u.get(p);if(y!==void 0&&y.has(m))return Promise.resolve();const k=l.get(p);if(k!==void 0){const _=k.get(m);if(_!==void 0)return _}const b=r(p),S=b.audioWorklet===void 0?i(m).then(([_,w])=>{const[T,v]=Mr(_,w),A=`${T};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${v}
})})(window,'_AWGS')`;return t(A)}).then(()=>{const _=d._AWGS.pop();if(_===void 0)throw new SyntaxError;s(b.currentTime,b.sampleRate,()=>_(class{},void 0,(w,T)=>{if(w.trim()==="")throw e();const v=fi.get(b);if(v!==void 0){if(v.has(w))throw e();jr(T),Lr(T.parameterDescriptors),v.set(w,T)}else jr(T),Lr(T.parameterDescriptors),fi.set(b,new Map([[w,T]]))},b.sampleRate,void 0,void 0))}):Promise.all([i(m),Promise.resolve(n(h,h))]).then(([[_,w],T])=>{const v=f+1;f=v;const[A,E]=Mr(_,w),I=`${A};((AudioWorkletProcessor,registerProcessor)=>{${E}
})(${T?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${T?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${T?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${v}',class extends AudioWorkletProcessor{process(){return !1}})`,D=new Blob([I],{type:"application/javascript; charset=utf-8"}),R=URL.createObjectURL(D);return b.audioWorklet.addModule(R,g).then(()=>{if(a(b))return b;const P=o(b);return P.audioWorklet.addModule(R,g).then(()=>P)}).then(P=>{if(c===null)throw new SyntaxError;try{new c(P,`__sac${v}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(R))});return k===void 0?l.set(p,new Map([[m,S]])):k.set(m,S),S.then(()=>{const _=u.get(p);_===void 0?u.set(p,new Set([m])):_.add(m)}).finally(()=>{const _=l.get(p);_!==void 0&&_.delete(m)}),S}},Je=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},An=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[s]=t;return n.delete(s),s},No=(n,e,t,s)=>{const i=Je(n,e),r=An(i,o=>o[0]===t&&o[1]===s);return i.size===0&&n.delete(e),r},Ps=n=>Je(Oo,n),es=n=>{if(Qt.has(n))throw new Error("The AudioNode is already stored.");Qt.add(n),Ps(n).forEach(e=>e(!0))},Ro=n=>"port"in n,Ds=n=>{if(!Qt.has(n))throw new Error("The AudioNode is not stored.");Qt.delete(n),Ps(n).forEach(e=>e(!1))},mi=(n,e)=>{!Ro(n)&&e.every(t=>t.size===0)&&Ds(n)},wu=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>{const f=new WeakMap;return(p,m,g,y,k)=>{const{activeInputs:b,passiveInputs:S}=r(m),{outputs:_}=r(p),w=a(p),T=v=>{const A=c(m),E=c(p);if(v){const x=No(S,p,g,y);n(b,p,x,!1),!k&&!h(p)&&t(E,A,g,y),d(m)&&es(m)}else{const x=s(b,p,g,y);e(S,y,x,!1),!k&&!h(p)&&i(E,A,g,y);const C=o(m);if(C===0)u(m)&&mi(m,b);else{const O=f.get(m);O!==void 0&&clearTimeout(O),f.set(m,setTimeout(()=>{u(m)&&mi(m,b)},C*1e3))}}};return l(_,[m,g,y],v=>v[0]===m&&v[1]===g&&v[2]===y,!0)?(w.add(T),u(p)?n(b,p,[g,y,T],!0):e(S,y,[p,g,T],!0),!0):!1}},bu=n=>(e,t,[s,i,r],o)=>{const a=e.get(s);a===void 0?e.set(s,new Set([[i,t,r]])):n(a,[i,t,r],c=>c[0]===i&&c[1]===t,o)},Tu=n=>(e,t)=>{const s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(s).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(s),s.disconnect()};t.addEventListener("ended",i)},ku=n=>(e,t)=>{n(e).add(t)},Su={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Cu=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...Su,...c},h=s(l,u),d=r(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Te=(n,e)=>n.context===e,Eu=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Te(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},ln=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Qe=()=>new DOMException("","IndexSizeError"),Oi=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(s){throw s.code===12?Qe():s}})(n.getChannelData)},Au={numberOfChannels:1},xu=(n,e,t,s,i,r,o,a)=>{let c=null;return class Po{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...Au,...u};c===null&&(c=new i(1,1,44100));const p=s!==null&&e(r,r)?new s({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(p.numberOfChannels===0)throw t();return typeof p.copyFromChannel!="function"?(o(p),Oi(p)):e(ln,()=>ln(p))||a(p),n.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===Po.prototype||n.has(u)}}},Ie=-34028234663852886e22,Se=-Ie,ot=n=>Qt.has(n),Ou={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Iu=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...Ou,...u},f=i(h,d),p=o(h),m=p?e():null;super(l,!1,f,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,p,f.playbackRate,Se,Ie)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){es(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),ot(this)&&Ds(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},Nu=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Te(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),o!==null&&h.start(...o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.playbackRate,h.playbackRate):await s(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Ru=n=>"playbackRate"in n,Pu=n=>"frequency"in n&&"gain"in n,Du=n=>"offset"in n,Mu=n=>!("frequency"in n)&&"gain"in n,Lu=n=>"detune"in n&&"frequency"in n&&!("gain"in n),ju=n=>"pan"in n,Ce=n=>Je(Ao,n),Ms=n=>Je(xo,n),gi=(n,e)=>{const{activeInputs:t}=Ce(n);t.forEach(i=>i.forEach(([r])=>{e.includes(n)||gi(r,[...e,n])}));const s=Ru(n)?[n.playbackRate]:Ro(n)?Array.from(n.parameters.values()):Pu(n)?[n.Q,n.detune,n.frequency,n.gain]:Du(n)?[n.offset]:Mu(n)?[n.gain]:Lu(n)?[n.detune,n.frequency]:ju(n)?[n.pan]:[];for(const i of s){const r=Ms(i);r!==void 0&&r.activeInputs.forEach(([o])=>gi(o,e))}ot(n)&&Ds(n)},Do=n=>{gi(n.destination,[])},Fu=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),Bu=(n,e,t,s,i,r,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?t():p}if(h===null)throw s();if(!Fu(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Do(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},$u=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d=o(h),f=i(h,u,d),p=d?e(a):null;super(l,!1,f,p),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Vu=n=>{const e=new WeakMap,t=async(s,i)=>{const r=i.destination;return e.set(i,r),await n(s,i,r),r};return{render(s,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):t(s,i)}}},qu=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const _=new Float32Array(1),w=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),T=o(l);let v=!1,A=[0,0,-1,0,1,0],E=[0,0,0];const x=()=>{if(v)return;v=!0;const D=s(l,256,9,0);D.onaudioprocess=({inputBuffer:R})=>{const P=[r(R,_,0),r(R,_,1),r(R,_,2),r(R,_,3),r(R,_,4),r(R,_,5)];P.some((L,$)=>L!==A[$])&&(u.setOrientation(...P),A=P);const U=[r(R,_,6),r(R,_,7),r(R,_,8)];U.some((L,$)=>L!==E[$])&&(u.setPosition(...U),E=U)},w.connect(D)},C=D=>R=>{R!==A[D]&&(A[D]=R,u.setOrientation(...A))},O=D=>R=>{R!==E[D]&&(E[D]=R,u.setPosition(...E))},I=(D,R,P)=>{const U=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R});U.connect(w,0,D),U.start(),Object.defineProperty(U.offset,"defaultValue",{get(){return R}});const L=n({context:c},T,U.offset,Se,Ie);return a(L,"value",$=>()=>$.call(L),$=>F=>{try{$.call(L,F)}catch(K){if(K.code!==9)throw K}x(),T&&P(F)}),L.cancelAndHoldAtTime=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.cancelAndHoldAtTime),L.cancelScheduledValues=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.cancelScheduledValues),L.exponentialRampToValueAtTime=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.exponentialRampToValueAtTime),L.linearRampToValueAtTime=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.linearRampToValueAtTime),L.setTargetAtTime=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.setTargetAtTime),L.setValueAtTime=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.setValueAtTime),L.setValueCurveAtTime=($=>T?()=>{throw i()}:(...F)=>{const K=$.apply(L,F);return x(),K})(L.setValueCurveAtTime),L};return{forwardX:I(0,0,C(0)),forwardY:I(1,0,C(1)),forwardZ:I(2,-1,C(2)),positionX:I(6,0,O(0)),positionY:I(7,0,O(1)),positionZ:I(8,0,O(2)),upX:I(3,0,C(3)),upY:I(4,1,C(4)),upZ:I(5,0,C(5))}},{forwardX:d,forwardY:f,forwardZ:p,positionX:m,positionY:g,positionZ:y,upX:k,upY:b,upZ:S}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return p},get positionX(){return m},get positionY(){return g},get positionZ(){return y},get upX(){return k},get upY(){return b},get upZ(){return S}}},un=n=>"context"in n,Ls=n=>un(n[0]),Lt=(n,e,t,s)=>{for(const i of n)if(t(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},Fr=(n,e,[t,s],i)=>{Lt(n,[e,t,s],r=>r[0]===e&&r[1]===t,i)},Br=(n,[e,t,s],i)=>{const r=n.get(e);r===void 0?n.set(e,new Set([[t,s]])):Lt(r,[t,s],o=>o[0]===t,i)},us=n=>"inputs"in n,hn=(n,e,t,s)=>{if(us(e)){const i=e.inputs[s];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,s),[e,t,s]},Mo=(n,e,t)=>{for(const s of n)if(s[0]===e&&s[1]===t)return n.delete(s),s;return null},Uu=(n,e,t)=>An(n,s=>s[0]===e&&s[1]===t),Lo=(n,e)=>{if(!Ps(n).delete(e))throw new Error("Missing the expected event listener.")},jo=(n,e,t)=>{const s=Je(n,e),i=An(s,r=>r[0]===t);return s.size===0&&n.delete(e),i},dn=(n,e,t,s)=>{us(e)?n.disconnect(e.inputs[s],t,0):n.disconnect(e,t,s)},te=n=>Je(Ai,n),As=n=>Je(xi,n),Pt=n=>di.has(n),sn=n=>!Qt.has(n),$r=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const s=n.createScriptProcessor(256,1,1),i=n.createGain(),r=n.createBuffer(1,2,44100),o=r.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=r,a.loop=!0,a.connect(s).connect(n.destination),a.connect(i),a.disconnect(i),s.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),Zn=(n,e)=>{const t=new Map;for(const s of n)for(const i of s){const r=t.get(i);t.set(i,r===void 0?1:r+1)}t.forEach((s,i)=>e(i,s))},fn=n=>"context"in n,Wu=n=>{const e=new Map;n.connect=(t=>(s,i=0,r=0)=>{const o=fn(s)?t(s,i,r):t(s,i),a=e.get(s);return a===void 0?e.set(s,[{input:r,output:i}]):a.every(c=>c.input!==r||c.output!==i)&&a.push({input:r,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(s,i,r)=>{if(t.apply(n),s===void 0)e.clear();else if(typeof s=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==s);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(s))if(i===void 0)e.delete(s);else{const o=e.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==r||r===void 0));a.length===0?e.delete(s):e.set(s,a)}}for(const[o,a]of e)a.forEach(c=>{fn(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},zu=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=Ms(e),{outputs:o}=Ce(n),a=Ps(n),c=l=>{const u=te(n),h=As(e);if(l){const d=jo(r,n,t);Fr(i,n,d,!1),!s&&!Pt(n)&&u.connect(h,t)}else{const d=Uu(i,n,t);Br(r,d,!1),!s&&!Pt(n)&&u.disconnect(h,t)}};return Lt(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),ot(n)?Fr(i,n,[t,c],!0):Br(r,[n,t,c],!0),!0):!1},Gu=(n,e,t,s)=>{const{activeInputs:i,passiveInputs:r}=Ce(e),o=Mo(i[s],n,t);return o===null?[No(r,n,t,s)[2],!1]:[o[2],!0]},Hu=(n,e,t)=>{const{activeInputs:s,passiveInputs:i}=Ms(e),r=Mo(s,n,t);return r===null?[jo(i,n,t)[1],!1]:[r[2],!0]},Ii=(n,e,t,s,i)=>{const[r,o]=Gu(n,t,s,i);if(r!==null&&(Lo(n,r),o&&!e&&!Pt(n)&&dn(te(n),te(t),s,i)),ot(t)){const{activeInputs:a}=Ce(t);mi(t,a)}},Ni=(n,e,t,s)=>{const[i,r]=Hu(n,t,s);i!==null&&(Lo(n,i),r&&!e&&!Pt(n)&&te(n).disconnect(As(t),s))},Ju=(n,e)=>{const t=Ce(n),s=[];for(const i of t.outputs)Ls(i)?Ii(n,e,...i):Ni(n,e,...i),s.push(i[0]);return t.outputs.clear(),s},Xu=(n,e,t)=>{const s=Ce(n),i=[];for(const r of s.outputs)r[1]===t&&(Ls(r)?Ii(n,e,...r):Ni(n,e,...r),i.push(r[0]),s.outputs.delete(r));return i},Ku=(n,e,t,s,i)=>{const r=Ce(n);return Array.from(r.outputs).filter(o=>o[0]===t&&(s===void 0||o[1]===s)&&(i===void 0||o[2]===i)).map(o=>(Ls(o)?Ii(n,e,...o):Ni(n,e,...o),r.outputs.delete(o),o[0]))},Yu=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,p,m)=>class extends l{constructor(y,k,b,S){super(b),this._context=y,this._nativeAudioNode=b;const _=u(y);h(_)&&t($r,()=>$r(_,m))!==!0&&Wu(b),Ai.set(this,b),Oo.set(this,new Set),y.state!=="closed"&&k&&es(this),n(this,S,b)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,k=0,b=0){if(k<0||k>=this._nativeAudioNode.numberOfOutputs)throw i();const S=u(this._context),_=p(S);if(d(y)||f(y))throw r();if(un(y)){const v=te(y);try{const E=hn(this._nativeAudioNode,v,k,b),x=sn(this);(_||x)&&this._nativeAudioNode.disconnect(...E),this.context.state!=="closed"&&!x&&sn(y)&&es(y)}catch(E){throw E.code===12?r():E}if(e(this,y,k,b,_)){const E=c([this],y);Zn(E,s(_))}return y}const w=As(y);if(w.name==="playbackRate"&&w.maxValue===1024)throw o();try{this._nativeAudioNode.connect(w,k),(_||sn(this))&&this._nativeAudioNode.disconnect(w,k)}catch(v){throw v.code===12?r():v}if(zu(this,y,k,_)){const v=c([this],y);Zn(v,s(_))}}disconnect(y,k,b){let S;const _=u(this._context),w=p(_);if(y===void 0)S=Ju(this,w);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw i();S=Xu(this,w,y)}else{if(k!==void 0&&(k<0||k>=this.numberOfOutputs)||un(y)&&b!==void 0&&(b<0||b>=y.numberOfInputs))throw i();if(S=Ku(this,w,y,k,b),S.length===0)throw r()}for(const T of S){const v=c([this],T);Zn(v,a)}}},Zu=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,p,m,g=null,y=null)=>{const k=m.value,b=new cu(k),S=p?s(b):null,_={get defaultValue(){return k},get maxValue(){return g===null?m.maxValue:g},get minValue(){return y===null?m.minValue:y},get value(){return m.value},set value(w){m.value=w,_.setValueAtTime(w,f.context.currentTime)},cancelAndHoldAtTime(w){if(typeof m.cancelAndHoldAtTime=="function")S===null&&b.flush(f.context.currentTime),b.add(i(w)),m.cancelAndHoldAtTime(w);else{const T=Array.from(b).pop();S===null&&b.flush(f.context.currentTime),b.add(i(w));const v=Array.from(b).pop();m.cancelScheduledValues(w),T!==v&&v!==void 0&&(v.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(v.value,v.endTime):v.type==="linearRampToValue"?m.linearRampToValueAtTime(v.value,v.endTime):v.type==="setValue"?m.setValueAtTime(v.value,v.startTime):v.type==="setValueCurve"&&m.setValueCurveAtTime(v.values,v.startTime,v.duration))}return _},cancelScheduledValues(w){return S===null&&b.flush(f.context.currentTime),b.add(r(w)),m.cancelScheduledValues(w),_},exponentialRampToValueAtTime(w,T){if(w===0)throw new RangeError;if(!Number.isFinite(T)||T<0)throw new RangeError;const v=f.context.currentTime;return S===null&&b.flush(v),Array.from(b).length===0&&(b.add(l(k,v)),m.setValueAtTime(k,v)),b.add(o(w,T)),m.exponentialRampToValueAtTime(w,T),_},linearRampToValueAtTime(w,T){const v=f.context.currentTime;return S===null&&b.flush(v),Array.from(b).length===0&&(b.add(l(k,v)),m.setValueAtTime(k,v)),b.add(a(w,T)),m.linearRampToValueAtTime(w,T),_},setTargetAtTime(w,T,v){return S===null&&b.flush(f.context.currentTime),b.add(c(w,T,v)),m.setTargetAtTime(w,T,v),_},setValueAtTime(w,T){return S===null&&b.flush(f.context.currentTime),b.add(l(w,T)),m.setValueAtTime(w,T),_},setValueCurveAtTime(w,T,v){const A=w instanceof Float32Array?w:new Float32Array(w);if(h!==null&&h.name==="webkitAudioContext"){const E=T+v,x=f.context.sampleRate,C=Math.ceil(T*x),O=Math.floor(E*x),I=O-C,D=new Float32Array(I);for(let P=0;P<I;P+=1){const U=(A.length-1)/v*((C+P)/x-T),L=Math.floor(U),$=Math.ceil(U);D[P]=L===$?A[L]:(1-(U-L))*A[L]+(1-($-U))*A[$]}S===null&&b.flush(f.context.currentTime),b.add(u(D,T,v)),m.setValueCurveAtTime(D,T,v);const R=O/x;R<E&&d(_,D[D.length-1],R),d(_,A[A.length-1],E)}else S===null&&b.flush(f.context.currentTime),b.add(u(A,T,v)),m.setValueCurveAtTime(A,T,v);return _}};return t.set(_,m),e.set(_,f),n(_,S),_},Qu=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:s,value:i}=t;e.exponentialRampToValueAtTime(i,s)}else if(t.type==="linearRampToValue"){const{endTime:s,value:i}=t;e.linearRampToValueAtTime(i,s)}else if(t.type==="setTarget"){const{startTime:s,target:i,timeConstant:r}=t;e.setTargetAtTime(i,s,r)}else if(t.type==="setValue"){const{startTime:s,value:i}=t;e.setValueAtTime(i,s)}else if(t.type==="setValueCurve"){const{duration:s,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,s)}else throw new Error("Can't apply an unknown automation.")}});class Fo{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((s,i)=>e.call(t,s,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const eh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},th=(n,e,t,s,i,r,o,a,c,l,u,h,d,f)=>class extends e{constructor(m,g,y){var k;const b=a(m),S=c(b),_=u({...eh,...y});d(_);const w=fi.get(b),T=w==null?void 0:w.get(g),v=S||b.state!=="closed"?b:(k=o(b))!==null&&k!==void 0?k:b,A=i(v,S?null:m.baseLatency,l,g,T,_),E=S?s(g,_,T):null;super(m,!0,A,E);const x=[];A.parameters.forEach((O,I)=>{const D=t(this,S,O);x.push([I,D])}),this._nativeAudioWorkletNode=A,this._onprocessorerror=null,this._parameters=new Fo(x),S&&n(b,this);const{activeInputs:C}=r(this);h(A,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?f(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===g?m:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function pn(n,e,t,s,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],s,i);else{const r=n.getChannelData(s);if(e[t].byteLength===0)e[t]=r.slice(i,i+128);else{const o=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const Bo=(n,e,t,s,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],s,i):e[t].byteLength!==0&&n.getChannelData(s).set(e[t],i)},mn=(n,e)=>{const t=[];for(let s=0;s<n;s+=1){const i=[],r=typeof e=="number"?e:e[s];for(let o=0;o<r;o+=1)i.push(new Float32Array(128));t.push(i)}return t},sh=(n,e)=>{const t=Je(pi,n),s=te(e);return Je(t,s)},nh=async(n,e,t,s,i,r,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=s.channelCount*s.numberOfInputs,l=i.reduce((g,y)=>g+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=Ce(n),d=await sh(t,n),f=mn(s.numberOfInputs,s.channelCount),p=mn(s.numberOfOutputs,i),m=Array.from(n.parameters.keys()).reduce((g,y)=>({...g,[y]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(s.numberOfInputs>0&&e!==null)for(let y=0;y<s.numberOfInputs;y+=1)for(let k=0;k<s.channelCount;k+=1)pn(e,f[y],k,k,g);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:y},k)=>{pn(e,m,y,c+k,g)});for(let y=0;y<s.numberOfInputs;y+=1)for(let k=0;k<i[y];k+=1)p[y][k].byteLength===0&&(p[y][k]=new Float32Array(128));try{const y=f.map((b,S)=>h.activeInputs[S].size===0?[]:b),k=o(g/t.sampleRate,t.sampleRate,()=>d.process(y,p,m));if(u!==null)for(let b=0,S=0;b<s.numberOfOutputs;b+=1){for(let _=0;_<i[b];_+=1)Bo(u,p[b],_,S+_,g);S+=i[b]}if(!k)break}catch(y){n.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},ih=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,p,m)=>(g,y,k)=>{const b=new WeakMap;let S=null;const _=async(w,T)=>{let v=u(w),A=null;const E=Te(v,T),x=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const C=x.reduce((R,P)=>R+P,0),O=i(T,{channelCount:Math.max(1,C),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,C)}),I=[];for(let R=0;R<w.numberOfOutputs;R+=1)I.push(s(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:x[R]}));const D=o(T,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});D.connect=e.bind(null,I),D.disconnect=c.bind(null,I),A=[O,I,D]}else E||(v=new h(T,g));if(b.set(T,A===null?v:A[2]),A!==null){if(S===null){if(k===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const P=w.channelCount*w.numberOfInputs,U=k.parameterDescriptors===void 0?0:k.parameterDescriptors.length,L=P+U;S=nh(w,L===0?null:await(async()=>{const F=new d(L,Math.ceil(w.context.length/128)*128,T.sampleRate),K=[],Re=[];for(let se=0;se<y.numberOfInputs;se+=1)K.push(o(F,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),Re.push(i(F,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const Pe=await Promise.all(Array.from(w.parameters.values()).map(async se=>{const ke=r(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:se.value});return await f(F,se,ke.offset),ke})),G=s(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,P+U)});for(let se=0;se<y.numberOfInputs;se+=1){K[se].connect(Re[se]);for(let ke=0;ke<y.channelCount;ke+=1)Re[se].connect(G,ke,se*y.channelCount+ke)}for(const[se,ke]of Pe.entries())ke.connect(G,0,P+se),ke.start(0);return G.connect(F.destination),await Promise.all(K.map(se=>p(w,F,se))),m(F)})(),T,y,x,k,l)}const C=await S,O=t(T,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[I,D,R]=A;C!==null&&(O.buffer=C,O.start(0)),O.connect(I);for(let P=0,U=0;P<w.numberOfOutputs;P+=1){const L=D[P];for(let $=0;$<x[P];$+=1)I.connect(L,U+$,$);U+=x[P]}return R}if(E)for(const[C,O]of w.parameters.entries())await n(T,O,v.parameters.get(C));else for(const[C,O]of w.parameters.entries())await f(T,O,v.parameters.get(C));return await p(w,T,v),v};return{render(w,T){a(T,w);const v=b.get(T);return v!==void 0?Promise.resolve(v):_(w,T)}}},rh=(n,e,t,s,i,r,o,a,c,l,u,h,d,f,p,m,g,y,k,b)=>class extends p{constructor(_,w){super(_,w),this._nativeContext=_,this._audioWorklet=n===void 0?void 0:{addModule:(T,v)=>n(this,T,v)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(_,w,T){return new t({length:w,numberOfChannels:_,sampleRate:T})}createBufferSource(){return new s(this)}createChannelMerger(_=6){return new r(this,{numberOfInputs:_})}createChannelSplitter(_=6){return new o(this,{numberOfOutputs:_})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(_=1){return new u(this,{maxDelayTime:_})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(_,w){return new f(this,{feedback:w,feedforward:_})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(_,w,T={disableNormalization:!1}){return new y(this,{...T,imag:w,real:_})}createStereoPanner(){return new k(this)}createWaveShaper(){return new b(this)}decodeAudioData(_,w,T){return l(this._nativeContext,_).then(v=>(typeof w=="function"&&w(v),v),v=>{throw typeof T=="function"&&T(v),v})}},oh={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ah=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...oh,...u},f=i(h,d),p=o(h),m=p?t():null;super(l,!1,f,m),this._Q=e(this,p,f.Q,Se,Ie),this._detune=e(this,p,f.detune,1200*Math.log2(Se),-1200*Math.log2(Se)),this._frequency=e(this,p,f.frequency,l.sampleRate/2,0),this._gain=e(this,p,f.gain,40*Math.log10(Se),Ie),this._nativeBiquadFilterNode=f,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?s():d}if(l.length!==u.length||u.length!==h.length)throw s()}},ch=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Te(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return r.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},lh=(n,e)=>(t,s)=>{const i=e.get(t);if(i!==void 0)return i;const r=n.get(t);if(r!==void 0)return r;try{const o=s();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},uh={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},hh=(n,e,t,s,i)=>class extends n{constructor(o,a){const c=s(o),l={...uh,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},dh=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Te(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},fh={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},ph=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=r({...fh,...c}),h=t(l,u),d=i(l)?e():null;super(a,!1,h,d)}},mh=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Te(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return s.set(o,a),await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},gh=n=>(e,t,s)=>n(t,e,s),_h=n=>(e,t,s=0,i=0)=>{const r=e[s];if(r===void 0)throw n();return fn(t)?r.connect(t,0,i):r.connect(t,0)},yh=n=>(e,t)=>{const s=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(t),s.start(),()=>{s.stop(),s.disconnect(t)}},vh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},wh=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...vh,...l},d=s(u,h),f=r(u),p=f?t():null;super(c,!1,d,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Se,Ie),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){es(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),ot(this)&&Ds(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},bh=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Te(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),o!==null&&h.start(o),a!==null&&h.stop(a)}return r.set(u,h),d?await n(u,l.offset,h.offset):await s(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Th=n=>e=>(n[0]=e,n[0]),kh={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Sh=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u={...kh,...c},h=t(l,u),f=i(l)?e():null;super(a,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},Ch=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Te(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return s.set(o,a),us(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},Eh=(n,e)=>(t,s,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,s,i)}catch(r){throw r.name==="SyntaxError"?n():r}},Ah=()=>new DOMException("","DataCloneError"),Vr=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(s=>{const i=()=>{t.onmessage=null,e.close(),t.close(),s()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},xh=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=o(h)?h:r(h);if(i.has(d)){const p=t();return Promise.reject(p)}try{i.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(p=>(Vr(d).catch(()=>{}),e(a,()=>a(p))||u(p),n.add(p),p)):new Promise((p,m)=>{const g=async()=>{try{await Vr(d)}catch{}},y=k=>{m(k),g()};try{f.decodeAudioData(d,k=>{typeof k.copyFromChannel!="function"&&(l(k),Oi(k)),n.add(k),g().then(()=>p(k))},k=>{y(k===null?s():k)})}catch(k){y(k)}})},Oh=(n,e,t,s,i,r,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const f=s(c),{outputs:p}=t(c);for(const m of p)if(Ls(m)){const g=s(m[0]);n(f,g,m[1],m[2])}else{const g=i(m[0]);f.connect(g,m[1])}}}else e.set(c,u-l)},Ih={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Nh=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Ih,...l},d=s(u,h),f=r(u),p=f?t(h.maxDelayTime):null;super(c,!1,d,p),this._delayTime=e(this,f,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},Rh=(n,e,t,s,i)=>r=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=Te(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,d)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await s(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},Ph=n=>(e,t,s,i)=>n(e[i],r=>r[0]===t&&r[1]===s),Dh=n=>(e,t)=>{n(e).delete(t)},Mh=n=>"delayTime"in n,Lh=(n,e,t)=>function s(i,r){const o=un(r)?r:t(n,r);if(Mh(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>s([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},Qs=(n,e,t)=>{const s=e[t];if(s===void 0)throw n();return s},jh=n=>(e,t=void 0,s=void 0,i=0)=>t===void 0?e.forEach(r=>r.disconnect()):typeof t=="number"?Qs(n,e,t).disconnect():fn(t)?s===void 0?e.forEach(r=>r.disconnect(t)):i===void 0?Qs(n,e,s).disconnect(t,0):Qs(n,e,s).disconnect(t,0,i):s===void 0?e.forEach(r=>r.disconnect(t)):Qs(n,e,s).disconnect(t,0),Fh={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Bh=(n,e,t,s,i,r,o,a)=>class extends n{constructor(l,u){const h=r(l),d={...Fh,...u},f=s(h,d),p=o(h),m=p?t():null;super(l,!1,f,m),this._attack=e(this,p,f.attack),this._knee=e(this,p,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,p,f.ratio),this._release=e(this,p,f.release),this._threshold=e(this,p,f.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},$h=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Te(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return r.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Vh=()=>new DOMException("","EncodingError"),qh=n=>e=>new Promise((t,s)=>{if(n===null){s(new SyntaxError);return}const i=n.document.head;if(i===null)s(new SyntaxError);else{const r=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,d,f,p)=>{if(h===a||h===n.location.href&&d===1&&f===1)return l(),s(p),!1;if(c!==null)return c(u,h,d,f,p)},r.onerror=()=>{l(),s(new SyntaxError)},r.onload=()=>{l(),t()},r.src=a,r.type="module",i.appendChild(r)}}),Uh=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,s,i){if(s!==null){let r=this._listeners.get(s);r===void 0&&(r=n(this,s),typeof s=="function"&&this._listeners.set(s,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,s,i){const r=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(t,r===void 0?null:r,i)}},Wh=n=>(e,t,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},zh=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},Gh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Hh=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...Gh,...c},h=s(l,u),d=r(l),f=d?t():null;super(a,!1,h,f),this._gain=e(this,d,h.gain,Se,Ie)}get gain(){return this._gain}},Jh=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Te(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.gain,l.gain):await s(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Xh=(n,e)=>t=>e(n,t),Kh=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},Yh=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},Zh=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},Qh=n=>e=>n.get(e),ge=()=>new DOMException("","InvalidStateError"),ed=n=>e=>{const t=n.get(e);if(t===void 0)throw ge();return t},td=(n,e)=>t=>{let s=n.get(t);if(s!==void 0)return s;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),n.set(t,s),s},sd=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},xn=()=>new DOMException("","InvalidAccessError"),nd=n=>{n.getFrequencyResponse=(e=>(t,s,i)=>{if(t.length!==s.length||s.length!==i.length)throw xn();return e.call(n,t,s,i)})(n.getFrequencyResponse)},id={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},rd=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=s(a),u=i(l),h={...id,...c},d=e(l,u?null:a.baseLatency,h),f=u?t(h.feedback,h.feedforward):null;super(a,!1,d,f),nd(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},$o=(n,e,t,s,i,r,o,a,c,l,u)=>{const h=l.length;let d=a;for(let f=0;f<h;f+=1){let p=t[0]*l[f];for(let m=1;m<i;m+=1){const g=d-m&c-1;p+=t[m]*r[g],p-=n[m]*o[g]}for(let m=i;m<s;m+=1)p+=t[m]*r[d-m&c-1];for(let m=i;m<e;m+=1)p-=n[m]*o[d-m&c-1];r[d]=l[f],o[d]=p,d=d+1&c-1,u[f]=p}return d},od=(n,e,t,s)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(i[0]!==1){for(let p=0;p<o;p+=1)r[p]/=i[0];for(let p=1;p<a;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),f=n.numberOfChannels;for(let p=0;p<f;p+=1){const m=n.getChannelData(p),g=d.getChannelData(p);u.fill(0),h.fill(0),$o(i,o,r,a,c,u,h,0,l,m,g)}return d},ad=(n,e,t,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const p=Te(f,h);if(h.createIIRFilter===void 0?d=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(f=h.createIIRFilter(o,r)),a.set(h,d===null?f:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,g,g.destination);const y=await i(g);return od(y,h,r,o)})()}const m=await c;return d.buffer=m,d.start(0),d}return await s(u,h,f),f};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},cd=(n,e,t,s,i,r)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&r(a)){const u=s(a),{outputs:h}=t(a);for(const d of h)if(Ls(d)){const f=s(d[0]);e(u,f,d[1],d[2])}else{const f=i(d[0]);u.disconnect(f,d[1])}}n.set(a,c)}else n.set(a,l+c)},ld=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},ud=(n,e)=>t=>n.has(t)||e(t),hd=(n,e)=>t=>n.has(t)||e(t),dd=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},fd=n=>e=>n!==null&&e instanceof n,pd=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,md=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,gd=(n,e)=>t=>n(t)||e(t),_d=n=>e=>n!==null&&e instanceof n,yd=n=>n!==null&&n.isSecureContext,vd=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},wd={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},bd=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r);if(s(a))throw new TypeError;const c={...wd,...o},l=e(a,c);super(r,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Td=(n,e,t,s)=>class extends n{constructor(r,o){const a=t(r),c=e(a,o);if(s(a))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},kd=(n,e,t)=>class extends n{constructor(i,r){const o=t(i),a=e(o,r);super(i,!0,a,null)}},Sd=(n,e,t,s,i,r)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,En.set(this,a),s(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?r(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},xs=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},Cd=(n,e)=>(t,s,i)=>{const r=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=r.size===0;if(e(a))return o.call(t,a,c,l),n(r,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&s(),a;o.call(t,a,c),n(r,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&s()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=r.size>0;if(a===void 0)o.apply(t),r.clear();else if(typeof a=="number"){o.call(t,a);for(const d of r)d[1]===a&&r.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of r)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&r.delete(d)}const h=r.size===0;u&&h&&i()})(t.disconnect),t},ne=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t]&&(n[t]=s)},pe=(n,e)=>{ne(n,e,"channelCount"),ne(n,e,"channelCountMode"),ne(n,e,"channelInterpretation")},qr=n=>typeof n.getFloatTimeDomainData=="function",Ed=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const s=Math.max(t.length,n.fftSize);for(let i=0;i<s;i+=1)e[i]=(t[i]-128)*.0078125;return e}},Ad=(n,e)=>(t,s)=>{const i=t.createAnalyser();if(pe(i,s),!(s.maxDecibels>s.minDecibels))throw e();return ne(i,s,"fftSize"),ne(i,s,"maxDecibels"),ne(i,s,"minDecibels"),ne(i,s,"smoothingTimeConstant"),n(qr,()=>qr(i))||Ed(i),i},xd=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,ae=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t].value&&(n[t].value=s)},Od=n=>{n.start=(e=>{let t=!1;return(s=0,i=0,r)=>{if(t)throw ge();e.call(n,s,i,r),t=!0}})(n.start)},Ri=n=>{n.start=(e=>(t=0,s=0,i)=>{if(typeof i=="number"&&i<0||s<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,s,i)})(n.start)},Pi=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},Id=(n,e,t,s,i,r,o,a,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return pe(f,d),ae(f,d,"playbackRate"),ne(f,d,"buffer"),ne(f,d,"loop"),ne(f,d,"loopEnd"),ne(f,d,"loopStart"),e(t,()=>t(h))||Od(f),e(s,()=>s(h))||c(f),e(i,()=>i(h))||l(f,h),e(r,()=>r(h))||Ri(f),e(o,()=>o(h))||u(f,h),e(a,()=>a(h))||Pi(f),n(h,f),f},Nd=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,Rd=(n,e)=>(t,s,i)=>{const r=t.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=n(t,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{r.channelCount=c}catch(l){if(c>r.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),r.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o},Pd=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,Dd=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},Md=(n,e,t,s,i)=>(r,o,a,c,l,u)=>{if(a!==null)try{const h=new a(r,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>f,set:p=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof p=="function"?p:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const y=d.get(m[1]);y!==void 0?m[1]=y:(m[1]=k=>{k.type==="error"?(Object.defineProperties(k,{type:{value:"processorerror"}}),g(k)):g(new ErrorEvent(m[0],{...k}))},d.set(g,m[1]))}}return p.call(h,"error",m[1],m[2]),p.call(h,...m)})(h.addEventListener),h.removeEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=d.get(m[1]);g!==void 0&&(d.delete(m[1]),m[1]=g)}return p.call(h,"error",m[1],m[2]),p.call(h,m[0],m[1],m[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(r.destination),i(h,()=>p.disconnect(),()=>p.connect(r.destination))}return h}catch(h){throw h.code===11?s():h}if(l===void 0)throw s();return Dd(u),e(r,o,l,u)},Vo=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),Ld=n=>new Promise((e,t)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:r})=>{s.close(),i.close(),e(r)},s.onmessageerror=({data:r})=>{s.close(),i.close(),t(r)},i.postMessage(n)}),jd=async(n,e)=>{const t=await Ld(e);return new n(t)},Fd=(n,e,t,s)=>{let i=pi.get(n);i===void 0&&(i=new WeakMap,pi.set(n,i));const r=jd(t,s);return i.set(e,r),r},Bd=(n,e,t,s,i,r,o,a,c,l,u,h,d)=>(f,p,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some(N=>N<1))throw c();if(y.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();const k=g.channelCount*g.numberOfInputs,b=y.reduce((N,j)=>N+j,0),S=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(k+S>6||b>6)throw c();const _=new MessageChannel,w=[],T=[];for(let N=0;N<g.numberOfInputs;N+=1)w.push(o(f,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(i(f,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const v=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:N,maxValue:j,minValue:fe,name:ie}of m.parameterDescriptors){const J=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[ie]!==void 0?g.parameterData[ie]:N===void 0?0:N});Object.defineProperties(J.offset,{defaultValue:{get:()=>N===void 0?0:N},maxValue:{get:()=>j===void 0?Se:j},minValue:{get:()=>fe===void 0?Ie:fe}}),v.push(J)}const A=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,k+S)}),E=Vo(p,f.sampleRate),x=a(f,E,k+S,Math.max(1,b)),C=i(f,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),O=[];for(let N=0;N<g.numberOfOutputs;N+=1)O.push(s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[N]}));for(let N=0;N<g.numberOfInputs;N+=1){w[N].connect(T[N]);for(let j=0;j<g.channelCount;j+=1)T[N].connect(A,j,N*g.channelCount+j)}const I=new Fo(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:N},j)=>{const fe=v[j];return fe.connect(A,0,k+j),fe.start(0),[N,fe.offset]}));A.connect(x);let D=g.channelInterpretation,R=null;const P=g.numberOfOutputs===0?[x]:O,U={get bufferSize(){return E},get channelCount(){return g.channelCount},set channelCount(N){throw t()},get channelCountMode(){return g.channelCountMode},set channelCountMode(N){throw t()},get channelInterpretation(){return D},set channelInterpretation(N){for(const j of w)j.channelInterpretation=N;D=N},get context(){return x.context},get inputs(){return w},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return R},set onprocessorerror(N){typeof R=="function"&&U.removeEventListener("processorerror",R),R=typeof N=="function"?N:null,typeof R=="function"&&U.addEventListener("processorerror",R)},get parameters(){return I},get port(){return _.port2},addEventListener(...N){return x.addEventListener(N[0],N[1],N[2])},connect:n.bind(null,P),disconnect:l.bind(null,P),dispatchEvent(...N){return x.dispatchEvent(N[0])},removeEventListener(...N){return x.removeEventListener(N[0],N[1],N[2])}},L=new Map;_.port1.addEventListener=(N=>(...j)=>{if(j[0]==="message"){const fe=typeof j[1]=="function"?j[1]:typeof j[1]=="object"&&j[1]!==null&&typeof j[1].handleEvent=="function"?j[1].handleEvent:null;if(fe!==null){const ie=L.get(j[1]);ie!==void 0?j[1]=ie:(j[1]=J=>{u(f.currentTime,f.sampleRate,()=>fe(J))},L.set(fe,j[1]))}}return N.call(_.port1,j[0],j[1],j[2])})(_.port1.addEventListener),_.port1.removeEventListener=(N=>(...j)=>{if(j[0]==="message"){const fe=L.get(j[1]);fe!==void 0&&(L.delete(j[1]),j[1]=fe)}return N.call(_.port1,j[0],j[1],j[2])})(_.port1.removeEventListener);let $=null;Object.defineProperty(_.port1,"onmessage",{get:()=>$,set:N=>{typeof $=="function"&&_.port1.removeEventListener("message",$),$=typeof N=="function"?N:null,typeof $=="function"&&(_.port1.addEventListener("message",$),_.port1.start())}}),m.prototype.port=_.port1;let F=null;Fd(f,U,m,g).then(N=>F=N);const Re=mn(g.numberOfInputs,g.channelCount),Pe=mn(g.numberOfOutputs,y),G=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((N,{name:j})=>({...N,[j]:new Float32Array(128)}),{});let se=!0;const ke=()=>{g.numberOfOutputs>0&&x.disconnect(C);for(let N=0,j=0;N<g.numberOfOutputs;N+=1){const fe=O[N];for(let ie=0;ie<y[N];ie+=1)C.disconnect(fe,j+ie,ie);j+=y[N]}},M=new Map;x.onaudioprocess=({inputBuffer:N,outputBuffer:j})=>{if(F!==null){const fe=h(U);for(let ie=0;ie<E;ie+=128){for(let J=0;J<g.numberOfInputs;J+=1)for(let oe=0;oe<g.channelCount;oe+=1)pn(N,Re[J],oe,oe,ie);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:J},oe)=>{pn(N,G,J,k+oe,ie)});for(let J=0;J<g.numberOfInputs;J+=1)for(let oe=0;oe<y[J];oe+=1)Pe[J][oe].byteLength===0&&(Pe[J][oe]=new Float32Array(128));try{const J=Re.map((Le,dt)=>{if(fe[dt].size>0)return M.set(dt,E/128),Le;const Wn=M.get(dt);return Wn===void 0?[]:(Le.every(Pa=>Pa.every(Da=>Da===0))&&(Wn===1?M.delete(dt):M.set(dt,Wn-1)),Le)});se=u(f.currentTime+ie/f.sampleRate,f.sampleRate,()=>F.process(J,Pe,G));for(let Le=0,dt=0;Le<g.numberOfOutputs;Le+=1){for(let _s=0;_s<y[Le];_s+=1)Bo(j,Pe[Le],_s,dt+_s,ie);dt+=y[Le]}}catch(J){se=!1,U.dispatchEvent(new ErrorEvent("processorerror",{colno:J.colno,filename:J.filename,lineno:J.lineno,message:J.message}))}if(!se){for(let J=0;J<g.numberOfInputs;J+=1){w[J].disconnect(T[J]);for(let oe=0;oe<g.channelCount;oe+=1)T[ie].disconnect(A,oe,J*g.channelCount+oe)}if(m.parameterDescriptors!==void 0){const J=m.parameterDescriptors.length;for(let oe=0;oe<J;oe+=1){const Le=v[oe];Le.disconnect(A,0,k+oe),Le.stop()}}A.disconnect(x),x.onaudioprocess=null,Ct?ke():$t();break}}}};let Ct=!1;const Et=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Bt=()=>x.connect(Et).connect(f.destination),$t=()=>{x.disconnect(Et),Et.disconnect()},Na=()=>{if(se){$t(),g.numberOfOutputs>0&&x.connect(C);for(let N=0,j=0;N<g.numberOfOutputs;N+=1){const fe=O[N];for(let ie=0;ie<y[N];ie+=1)C.connect(fe,j+ie,ie);j+=y[N]}}Ct=!0},Ra=()=>{se&&(Bt(),ke()),Ct=!1};return Bt(),d(U,Na,Ra)},qo=(n,e)=>{const t=n.createBiquadFilter();return pe(t,e),ae(t,e,"Q"),ae(t,e,"detune"),ae(t,e,"frequency"),ae(t,e,"gain"),ne(t,e,"type"),t},$d=(n,e)=>(t,s)=>{const i=t.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),pe(i,s),i},Vd=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw ge()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw ge()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw ge()}})},js=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return pe(t,e),Vd(t),t},qd=(n,e,t,s,i)=>(r,o)=>{if(r.createConstantSource===void 0)return t(r,o);const a=r.createConstantSource();return pe(a,o),ae(a,o,"offset"),e(s,()=>s(r))||Ri(a),e(i,()=>i(r))||Pi(a),n(r,a),a},hs=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),Ud=(n,e,t,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return n(i,c),s(hs(h,l),d,f)},Wd=(n,e)=>(t,s)=>{const i=t.createConvolver();if(pe(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),ne(i,s,"buffer"),s.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>o=>{if(o>2)throw n();return r.call(i,o)}),s.channelCountMode==="max"))throw n();return e(i,"channelCountMode",r=>()=>r.call(i),r=>o=>{if(o==="max")throw n();return r.call(i,o)}),i},Uo=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return pe(t,e),ae(t,e,"delayTime"),t},zd=n=>(e,t)=>{const s=e.createDynamicsCompressor();if(pe(s,t),t.channelCount>2||t.channelCountMode==="max")throw n();return ae(s,t,"attack"),ae(s,t,"knee"),ae(s,t,"ratio"),ae(s,t,"release"),ae(s,t,"threshold"),s},Ne=(n,e)=>{const t=n.createGain();return pe(t,e),ae(t,e,"gain"),t},Gd=n=>(e,t,s)=>{if(e.createIIRFilter===void 0)return n(e,t,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return pe(i,s),i};function Hd(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function Jd(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function Ur(n,e){let t=[0,0];for(let s=n.length-1;s>=0;s-=1)t=Jd(t,e),t[0]+=n[s];return t}const Xd=(n,e,t,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Vo(r,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),p=d.length,m=f.length,g=Math.min(p,m);if(p===0||p>20)throw s();if(d[0]===0)throw e();if(m===0||m>20)throw s();if(f[0]===0)throw e();if(d[0]!==1){for(let v=0;v<m;v+=1)f[v]/=d[0];for(let v=1;v<p;v+=1)d[v]/=d[0]}const y=t(i,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const k=32,b=[],S=[],_=[];for(let v=0;v<o;v+=1){b.push(0);const A=new Float32Array(k),E=new Float32Array(k);A.fill(0),E.fill(0),S.push(A),_.push(E)}y.onaudioprocess=v=>{const A=v.inputBuffer,E=v.outputBuffer,x=A.numberOfChannels;for(let C=0;C<x;C+=1){const O=A.getChannelData(C),I=E.getChannelData(C);b[C]=$o(d,p,f,m,g,S[C],_[C],b[C],k,O,I)}};const w=i.sampleRate/2;return hs({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(v){y.channelCount=v},get channelCountMode(){return y.channelCountMode},set channelCountMode(v){y.channelCountMode=v},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(v){y.channelInterpretation=v},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...v){return y.addEventListener(v[0],v[1],v[2])},dispatchEvent(...v){return y.dispatchEvent(v[0])},getFrequencyResponse(v,A,E){if(v.length!==A.length||A.length!==E.length)throw n();const x=v.length;for(let C=0;C<x;C+=1){const O=-Math.PI*(v[C]/w),I=[Math.cos(O),Math.sin(O)],D=Ur(f,I),R=Ur(d,I),P=Hd(D,R);A[C]=Math.sqrt(P[0]*P[0]+P[1]*P[1]),E[C]=Math.atan2(P[1],P[0])}},removeEventListener(...v){return y.removeEventListener(v[0],v[1],v[2])}},y)},Kd=(n,e)=>n.createMediaElementSource(e.mediaElement),Yd=(n,e)=>{const t=n.createMediaStreamDestination();return pe(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},Zd=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,o)=>r.id<o.id?-1:r.id>o.id?1:0);const s=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},Qd=(n,e)=>(t,{mediaStreamTrack:s})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=t.createMediaStreamSource(i);if(s.kind!=="audio")throw n();if(e(t))throw new TypeError;return r},ef=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,tf=(n,e,t,s,i,r)=>(o,a)=>{const c=o.createOscillator();return pe(c,a),ae(c,a,"detune"),ae(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):ne(c,a,"type"),e(t,()=>t(o))||Ri(c),e(s,()=>s(o))||r(c,o),e(i,()=>i(o))||Pi(c),n(o,c),c},sf=n=>(e,t)=>{const s=e.createPanner();return s.orientationX===void 0?n(e,t):(pe(s,t),ae(s,t,"orientationX"),ae(s,t,"orientationY"),ae(s,t,"orientationZ"),ae(s,t,"positionX"),ae(s,t,"positionY"),ae(s,t,"positionZ"),ne(s,t,"coneInnerAngle"),ne(s,t,"coneOuterAngle"),ne(s,t,"coneOuterGain"),ne(s,t,"distanceModel"),ne(s,t,"maxDistance"),ne(s,t,"panningModel"),ne(s,t,"refDistance"),ne(s,t,"rolloffFactor"),s)},nf=(n,e,t,s,i,r,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:p,maxDistance:m,orientationX:g,orientationY:y,orientationZ:k,panningModel:b,positionX:S,positionY:_,positionZ:w,refDistance:T,rolloffFactor:v,...A})=>{const E=u.createPanner();if(A.channelCount>2||A.channelCountMode==="max")throw o();pe(E,A);const x={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},C=t(u,{...x,channelInterpretation:"speakers",numberOfInputs:6}),O=s(u,{...A,gain:1}),I=s(u,{...x,gain:1}),D=s(u,{...x,gain:0}),R=s(u,{...x,gain:0}),P=s(u,{...x,gain:0}),U=s(u,{...x,gain:0}),L=s(u,{...x,gain:0}),$=i(u,256,6,1),F=r(u,{...x,curve:new Float32Array([1,1]),oversample:"none"});let K=[g,y,k],Re=[S,_,w];const Pe=new Float32Array(1);$.onaudioprocess=({inputBuffer:M})=>{const Ct=[c(M,Pe,0),c(M,Pe,1),c(M,Pe,2)];Ct.some((Bt,$t)=>Bt!==K[$t])&&(E.setOrientation(...Ct),K=Ct);const Et=[c(M,Pe,3),c(M,Pe,4),c(M,Pe,5)];Et.some((Bt,$t)=>Bt!==Re[$t])&&(E.setPosition(...Et),Re=Et)},Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(U.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0});const G={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(M){if(M>2)throw o();O.channelCount=M,E.channelCount=M},get channelCountMode(){return E.channelCountMode},set channelCountMode(M){if(M==="max")throw o();O.channelCountMode=M,E.channelCountMode=M},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(M){O.channelInterpretation=M,E.channelInterpretation=M},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(M){E.coneInnerAngle=M},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(M){E.coneOuterAngle=M},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(M){if(M<0||M>1)throw e();E.coneOuterGain=M},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(M){E.distanceModel=M},get inputs(){return[O]},get maxDistance(){return E.maxDistance},set maxDistance(M){if(M<0)throw new RangeError;E.maxDistance=M},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return I.gain},get orientationY(){return D.gain},get orientationZ(){return R.gain},get panningModel(){return E.panningModel},set panningModel(M){E.panningModel=M},get positionX(){return P.gain},get positionY(){return U.gain},get positionZ(){return L.gain},get refDistance(){return E.refDistance},set refDistance(M){if(M<0)throw new RangeError;E.refDistance=M},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(M){if(M<0)throw new RangeError;E.rolloffFactor=M},addEventListener(...M){return O.addEventListener(M[0],M[1],M[2])},dispatchEvent(...M){return O.dispatchEvent(M[0])},removeEventListener(...M){return O.removeEventListener(M[0],M[1],M[2])}};h!==G.coneInnerAngle&&(G.coneInnerAngle=h),d!==G.coneOuterAngle&&(G.coneOuterAngle=d),f!==G.coneOuterGain&&(G.coneOuterGain=f),p!==G.distanceModel&&(G.distanceModel=p),m!==G.maxDistance&&(G.maxDistance=m),g!==G.orientationX.value&&(G.orientationX.value=g),y!==G.orientationY.value&&(G.orientationY.value=y),k!==G.orientationZ.value&&(G.orientationZ.value=k),b!==G.panningModel&&(G.panningModel=b),S!==G.positionX.value&&(G.positionX.value=S),_!==G.positionY.value&&(G.positionY.value=_),w!==G.positionZ.value&&(G.positionZ.value=w),T!==G.refDistance&&(G.refDistance=T),v!==G.rolloffFactor&&(G.rolloffFactor=v),(K[0]!==1||K[1]!==0||K[2]!==0)&&E.setOrientation(...K),(Re[0]!==0||Re[1]!==0||Re[2]!==0)&&E.setPosition(...Re);const se=()=>{O.connect(E),n(O,F,0,0),F.connect(I).connect(C,0,0),F.connect(D).connect(C,0,1),F.connect(R).connect(C,0,2),F.connect(P).connect(C,0,3),F.connect(U).connect(C,0,4),F.connect(L).connect(C,0,5),C.connect($).connect(u.destination)},ke=()=>{O.disconnect(E),a(O,F,0,0),F.disconnect(I),I.disconnect(C),F.disconnect(D),D.disconnect(C),F.disconnect(R),R.disconnect(C),F.disconnect(P),P.disconnect(C),F.disconnect(U),U.disconnect(C),F.disconnect(L),L.disconnect(C),C.disconnect($),$.disconnect(u.destination)};return l(hs(G,E),se,ke)},rf=n=>(e,{disableNormalization:t,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:t});if(Array.from(s).length<2)throw n();return a},Fs=(n,e,t,s)=>n.createScriptProcessor(e,t,s),of=(n,e)=>(t,s)=>{const i=s.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,s);const r=t.createStereoPanner();return pe(r,s),ae(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),r},af=(n,e,t,s,i,r)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,m,g,y)=>{const k=new Float32Array(16385),b=new Float32Array(16385);for(let A=0;A<16385;A+=1){const E=A/16384*c;k[A]=Math.cos(E),b[A]=Math.sin(E)}const S=t(p,{...l,gain:0}),_=s(p,{...u,curve:k}),w=s(p,{...u,curve:a}),T=t(p,{...l,gain:0}),v=s(p,{...u,curve:b});return{connectGraph(){m.connect(S),m.connect(w.inputs===void 0?w:w.inputs[0]),m.connect(T),w.connect(g),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(v.inputs===void 0?v:v.inputs[0]),_.connect(S.gain),v.connect(T.gain),S.connect(y,0,0),T.connect(y,0,1)},disconnectGraph(){m.disconnect(S),m.disconnect(w.inputs===void 0?w:w.inputs[0]),m.disconnect(T),w.disconnect(g),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(v.inputs===void 0?v:v.inputs[0]),_.disconnect(S.gain),v.disconnect(T.gain),S.disconnect(y,0,0),T.disconnect(y,0,1)}}},d=(p,m,g,y)=>{const k=new Float32Array(16385),b=new Float32Array(16385),S=new Float32Array(16385),_=new Float32Array(16385),w=Math.floor(16385/2);for(let P=0;P<16385;P+=1)if(P>w){const U=(P-w)/(16384-w)*c;k[P]=Math.cos(U),b[P]=Math.sin(U),S[P]=0,_[P]=1}else{const U=P/(16384-w)*c;k[P]=1,b[P]=0,S[P]=Math.cos(U),_[P]=Math.sin(U)}const T=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=t(p,{...l,gain:0}),A=s(p,{...u,curve:k}),E=t(p,{...l,gain:0}),x=s(p,{...u,curve:b}),C=s(p,{...u,curve:a}),O=t(p,{...l,gain:0}),I=s(p,{...u,curve:S}),D=t(p,{...l,gain:0}),R=s(p,{...u,curve:_});return{connectGraph(){m.connect(T),m.connect(C.inputs===void 0?C:C.inputs[0]),T.connect(v,0),T.connect(E,0),T.connect(O,1),T.connect(D,1),C.connect(g),g.connect(A.inputs===void 0?A:A.inputs[0]),g.connect(x.inputs===void 0?x:x.inputs[0]),g.connect(I.inputs===void 0?I:I.inputs[0]),g.connect(R.inputs===void 0?R:R.inputs[0]),A.connect(v.gain),x.connect(E.gain),I.connect(O.gain),R.connect(D.gain),v.connect(y,0,0),O.connect(y,0,0),E.connect(y,0,1),D.connect(y,0,1)},disconnectGraph(){m.disconnect(T),m.disconnect(C.inputs===void 0?C:C.inputs[0]),T.disconnect(v,0),T.disconnect(E,0),T.disconnect(O,1),T.disconnect(D,1),C.disconnect(g),g.disconnect(A.inputs===void 0?A:A.inputs[0]),g.disconnect(x.inputs===void 0?x:x.inputs[0]),g.disconnect(I.inputs===void 0?I:I.inputs[0]),g.disconnect(R.inputs===void 0?R:R.inputs[0]),A.disconnect(v.gain),x.disconnect(E.gain),I.disconnect(O.gain),R.disconnect(D.gain),v.disconnect(y,0,0),O.disconnect(y,0,0),E.disconnect(y,0,1),D.disconnect(y,0,1)}}},f=(p,m,g,y,k)=>{if(m===1)return h(p,g,y,k);if(m===2)return d(p,g,y,k);throw i()};return(p,{channelCount:m,channelCountMode:g,pan:y,...k})=>{if(g==="max")throw i();const b=n(p,{...k,channelCount:1,channelCountMode:g,numberOfInputs:2}),S=t(p,{...k,channelCount:m,channelCountMode:g,gain:1}),_=t(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:w,disconnectGraph:T}=f(p,m,S,_,b);Object.defineProperty(_.gain,"defaultValue",{get:()=>0}),Object.defineProperty(_.gain,"maxValue",{get:()=>1}),Object.defineProperty(_.gain,"minValue",{get:()=>-1});const v={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(C){S.channelCount!==C&&(A&&T(),{connectGraph:w,disconnectGraph:T}=f(p,C,S,_,b),A&&w()),S.channelCount=C},get channelCountMode(){return S.channelCountMode},set channelCountMode(C){if(C==="clamped-max"||C==="max")throw i();S.channelCountMode=C},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(C){S.channelInterpretation=C},get context(){return S.context},get inputs(){return[S]},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get pan(){return _.gain},addEventListener(...C){return S.addEventListener(C[0],C[1],C[2])},dispatchEvent(...C){return S.dispatchEvent(C[0])},removeEventListener(...C){return S.removeEventListener(C[0],C[1],C[2])}};let A=!1;const E=()=>{w(),A=!0},x=()=>{T(),A=!1};return r(hs(v,b),E,x)}},cf=(n,e,t,s,i,r,o)=>(a,c)=>{const l=a.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);pe(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();ne(l,{curve:u},"curve"),ne(l,c,"oversample");let h=null,d=!1;return o(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),d&&(s(g)&&h===null?h=n(a,l):!s(g)&&h!==null&&(h(),h=null)),g)),i(l,()=>{d=!0,s(l.curve)&&(h=n(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},lf=(n,e,t,s,i)=>(r,{curve:o,oversample:a,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();pe(l,c),pe(u,c);const h=t(r,{...c,gain:1}),d=t(r,{...c,gain:-1}),f=t(r,{...c,gain:1}),p=t(r,{...c,gain:-1});let m=null,g=!1,y=null;const k={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(_){h.channelCount=_,d.channelCount=_,l.channelCount=_,f.channelCount=_,u.channelCount=_,p.channelCount=_},get channelCountMode(){return l.channelCountMode},set channelCountMode(_){h.channelCountMode=_,d.channelCountMode=_,l.channelCountMode=_,f.channelCountMode=_,u.channelCountMode=_,p.channelCountMode=_},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(_){h.channelInterpretation=_,d.channelInterpretation=_,l.channelInterpretation=_,f.channelInterpretation=_,u.channelInterpretation=_,p.channelInterpretation=_},get context(){return l.context},get curve(){return y},set curve(_){if(_!==null&&_.length<2)throw e();if(_===null)l.curve=_,u.curve=_;else{const w=_.length,T=new Float32Array(w+2-w%2),v=new Float32Array(w+2-w%2);T[0]=_[0],v[0]=-_[w-1];const A=Math.ceil((w+1)/2),E=(w+1)/2-1;for(let x=1;x<A;x+=1){const C=x/A*E,O=Math.floor(C),I=Math.ceil(C);T[x]=O===I?_[O]:(1-(C-O))*_[O]+(1-(I-C))*_[I],v[x]=O===I?-_[w-1-O]:-((1-(C-O))*_[w-1-O])-(1-(I-C))*_[w-1-I]}T[A]=w%2===1?_[A-1]:(_[A-2]+_[A-1])/2,l.curve=T,u.curve=v}y=_,g&&(s(y)&&m===null?m=n(r,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(_){l.oversample=_,u.oversample=_},addEventListener(..._){return h.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return h.dispatchEvent(_[0])},removeEventListener(..._){return h.removeEventListener(_[0],_[1],_[2])}};o!==null&&(k.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==k.oversample&&(k.oversample=a);const b=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(p).connect(f),g=!0,s(y)&&(m=n(r,h))},S=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(p),p.disconnect(f),g=!1,m!==null&&(m(),m=null)};return i(hs(k,f),b,S)},Ae=()=>new DOMException("","NotSupportedError"),uf={numberOfChannels:1},hf=(n,e,t,s,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...uf,...l},f=s(h,u,d);e(xs,()=>xs(f))||f.addEventListener("statechange",(()=>{let p=0;const m=g=>{this._state==="running"&&(p>0?(f.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):p+=1)};return m})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Do(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},df={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ff=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...df,...l},d=t(u,h),f=r(u),p=f?s():null,m=c.sampleRate/2;super(c,!1,d,p),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){es(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),ot(this)&&Ds(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},pf=(n,e,t,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const f=Te(d,h);if(!f){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,p),a!==null&&d.start(a),c!==null&&d.stop(c)}return r.set(h,d),f?(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)):(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=r.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},mf={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},gf=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...mf,...l},d=t(u,h),f=r(u),p=f?s():null;super(c,!1,d,p),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Se,Ie),this._orientationY=e(this,f,d.orientationY,Se,Ie),this._orientationZ=e(this,f,d.orientationZ,Se,Ie),this._positionX=e(this,f,d.positionX,Se,Ie),this._positionY=e(this,f,d.positionY,Se,Ie),this._positionZ=e(this,f,d.positionZ,Se,Ie),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},_f=(n,e,t,s,i,r,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,p)=>{let m=null,g=r(f);const y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},k={...y,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},b=Te(g,p);if("bufferSize"in g)m=s(p,{...y,gain:1});else if(!b){const S={...k,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,S)}if(u.set(p,m===null?g:m),m!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const x=new o(6,f.context.length,p.sampleRate),C=e(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});C.connect(x.destination),h=(async()=>{const O=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(I,D)=>{const R=t(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:D===0?1:0});return await a(x,I,R.offset),R}));for(let I=0;I<6;I+=1)O[I].connect(C,0,I),O[I].start(0);return l(x)})()}const S=await h,_=s(p,{...y,gain:1});await c(f,p,_);const w=[];for(let x=0;x<S.numberOfChannels;x+=1)w.push(S.getChannelData(x));let T=[w[0][0],w[1][0],w[2][0]],v=[w[3][0],w[4][0],w[5][0]],A=s(p,{...y,gain:1}),E=i(p,{...k,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:v[0],positionY:v[1],positionZ:v[2]});_.connect(A).connect(E.inputs[0]),E.connect(m);for(let x=128;x<S.length;x+=128){const C=[w[0][x],w[1][x],w[2][x]],O=[w[3][x],w[4][x],w[5][x]];if(C.some((I,D)=>I!==T[D])||O.some((I,D)=>I!==v[D])){T=C,v=O;const I=x/p.sampleRate;A.gain.setValueAtTime(0,I),A=s(p,{...y,gain:0}),E=i(p,{...k,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),A.gain.setValueAtTime(1,I),_.connect(A).connect(E.inputs[0]),E.connect(m)}}return m}return b?(await n(p,f.orientationX,g.orientationX),await n(p,f.orientationY,g.orientationY),await n(p,f.orientationZ,g.orientationZ),await n(p,f.positionX,g.positionX),await n(p,f.positionY,g.positionY),await n(p,f.positionZ,g.positionZ)):(await a(p,f.orientationX,g.orientationX),await a(p,f.orientationY,g.orientationY),await a(p,f.orientationZ,g.orientationZ),await a(p,f.positionX,g.positionX),await a(p,f.positionY,g.positionY),await a(p,f.positionZ,g.positionZ)),us(g)?await c(f,p,g.inputs[0]):await c(f,p,g),g};return{render(f,p){const m=u.get(p);return m!==void 0?Promise.resolve(m):d(f,p)}}},yf={disableNormalization:!1},vf=(n,e,t,s)=>class Wo{constructor(r,o){const a=e(r),c=s({...yf,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===Wo.prototype||t.has(r)}},wf=(n,e)=>(t,s,i)=>(n(s).replay(i),e(s,t,i)),bf=(n,e,t)=>async(s,i,r)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,i),f=s.context.destination;!t(l)&&(s!==f||!t(s))&&d.connect(r,u,c)})).reduce((a,c)=>[...a,...c],[]))},Tf=(n,e,t)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(r,c)}))},kf=(n,e,t,s)=>i=>n(xs,()=>xs(i))?Promise.resolve(n(s,s)).then(r=>{if(!r){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),r(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),Sf=n=>(e,t)=>{n.set(e,t)},Cf=n=>(e,t)=>n.set(e,t),Ef=(n,e,t,s,i,r,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(s(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),Oi(u)):e(r,()=>r(u))||a(u),n.add(u),u)),Af={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},xf=(n,e,t,s,i,r)=>class extends n{constructor(a,c){const l=i(a),u={...Af,...c},h=t(l,u),d=r(l),f=d?s():null;super(a,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},Of=(n,e,t,s,i)=>()=>{const r=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Te(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return r.set(c,l),u?await n(c,a.pan,l.pan):await s(c,a.pan,l.pan),us(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},If=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},Nf=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>r=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o},Rf=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{s.disconnect(),i(t.currentTime!==0)},t.startRendering()})},Pf=()=>new DOMException("","UnknownError"),Df={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Mf=(n,e,t,s,i,r,o)=>class extends n{constructor(c,l){const u=i(c),h={...Df,...l},d=t(u,h),p=r(u)?s():null;super(c,!0,d,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},Lf=(n,e,t)=>()=>{const s=new WeakMap,i=async(r,o)=>{let a=e(r);if(!Te(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return s.set(o,a),us(a)?await t(r,o,a.inputs[0]):await t(r,o,a),a};return{render(r,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):i(r,o)}}},jf=()=>typeof window>"u"?null:window,Ff=(n,e)=>t=>{t.copyFromChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)s[h]=l[h+o]},t.copyToChannel=(s,i,r=0)=>{const o=n(r),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=s[h]}},Bf=n=>e=>{e.copyFromChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(s,i,r=0)=>{const o=n(r),a=n(i);if(o<e.length)return t.call(e,s,a,o)})(e.copyToChannel)},$f=n=>(e,t)=>{const s=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=s),n(e,"buffer",i=>()=>{const r=i.call(e);return r===s?null:r},i=>r=>i.call(e,r===null?s:r))},Vf=(n,e)=>(t,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(s,0,c)},()=>i.disconnect(s))},zo=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),Go=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},Bs=(n,e,t,s)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(r),set:s(o)})},qf=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),Uf=n=>({...n,channelCount:n.numberOfOutputs}),Wf=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},Ho=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(s){if(s.code!==9)throw s;Ho(n,e,t+1e-7)}},zf=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},Gf=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},Hf=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Di=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},Jo=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},Mi=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},Jf=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},Xf=n=>{n.start=(e=>(t=0,s=0,i)=>{const r=n.buffer,o=r===null?s:Math.min(r.duration,s);r!==null&&o>r.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},Xo=(n,e)=>{const t=e.createGain();n.connect(t);const s=(i=>()=>{i.call(n,t),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),hs(n,t),n.stop=(i=>{let r=!1;return(o=0)=>{if(r)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),r=!0}})(n.stop)},ds=(n,e)=>t=>{const s={value:n};return Object.defineProperties(t,{currentTarget:s,target:s}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},Kf=mu(Lt),Yf=bu(Lt),Zf=Ph(An),Ko=new WeakMap,Qf=Yh(Ko),Xe=lh(new Map,new WeakMap),Ze=jf(),Yo=Ad(Xe,Qe),Li=Kh(Ce),ve=bf(Ce,Li,Pt),ep=Eu(Yo,te,ve),ee=ed(En),lt=ef(Ze),Y=_d(lt),Zo=new WeakMap,Qo=Uh(ds),$s=Nd(Ze),ji=fd($s),Fi=pd(Ze),ea=md(Ze),Os=Pd(Ze),le=Yu(gu(Ao),wu(Kf,Yf,hn,Zf,dn,Ce,Qf,Ps,te,Lt,ot,Pt,sn),Xe,cd(di,dn,Ce,te,As,ot),Qe,xn,Ae,Oh(hn,di,Ce,te,As,ee,ot,Y),Lh(Zo,Ce,Je),Qo,ee,ji,Fi,ea,Y,Os),tp=Cu(le,ep,Qe,Yo,ee,Y),Bi=new WeakSet,Wr=xd(Ze),ta=Th(new Uint32Array(1)),$i=Ff(ta,Qe),Vi=Bf(ta),sa=xu(Bi,Xe,Ae,Wr,lt,If(Wr),$i,Vi),On=Tu(Ne),na=Tf(Li,Ms,Pt),et=gh(na),fs=Id(On,Xe,zf,Gf,Hf,Di,Jo,Mi,Xf,$f(Bs),Xo),tt=wf(Zh(Ms),na),sp=Nu(et,fs,te,tt,ve),Ke=Zu(_u(xo),Zo,xi,Qu,lu,uu,hu,du,fu,li,Co,$s,Ho),np=Iu(le,sp,Ke,ge,fs,ee,Y,ds),ip=$u(le,Vu,Qe,ge,Rd(Ne,Bs),ee,Y,ve),rp=ch(et,qo,te,tt,ve),jt=Cf(Ko),op=ah(le,Ke,rp,xn,qo,ee,Y,jt),Tt=Cd(Lt,Fi),ap=Vf(ge,Tt),kt=$d($s,ap),cp=dh(kt,te,ve),lp=hh(le,cp,kt,ee,Y),up=mh(js,te,ve),hp=ph(le,up,js,ee,Y,Uf),dp=Ud(On,fs,Ne,Tt),ps=qd(On,Xe,dp,Di,Mi),fp=bh(et,ps,te,tt,ve),pp=wh(le,Ke,fp,ps,ee,Y,ds),ia=Wd(Ae,Bs),mp=Ch(ia,te,ve),gp=Sh(le,mp,ia,ee,Y,jt),_p=Rh(et,Uo,te,tt,ve),yp=Nh(le,Ke,_p,Uo,ee,Y,jt),ra=zd(Ae),vp=$h(et,ra,te,tt,ve),wp=Bh(le,Ke,vp,ra,Ae,ee,Y,jt),bp=Jh(et,Ne,te,tt,ve),Tp=Hh(le,Ke,bp,Ne,ee,Y),kp=Xd(xn,ge,Fs,Ae),In=kf(Xe,Ne,Fs,Rf(Ne,lt)),Sp=ad(fs,te,lt,ve,In),Cp=Gd(kp),Ep=rd(le,Cp,Sp,ee,Y,jt),Ap=qu(Ke,kt,ps,Fs,Ae,zo,Y,Bs),oa=new WeakMap,xp=Sd(ip,Ap,Qo,Y,oa,ds),aa=tf(On,Xe,Di,Jo,Mi,Xo),Op=pf(et,aa,te,tt,ve),Ip=ff(le,Ke,aa,Op,ee,Y,ds),ca=yh(fs),Np=lf(ca,ge,Ne,Go,Tt),Nn=cf(ca,ge,Np,Go,Tt,$s,Bs),Rp=nf(hn,ge,kt,Ne,Fs,Nn,Ae,dn,zo,Tt),la=sf(Rp),Pp=_f(et,kt,ps,Ne,la,te,lt,tt,ve,In),Dp=gf(le,Ke,la,Pp,ee,Y,jt),Mp=rf(Qe),Lp=vf(Mp,ee,new WeakSet,Wf),jp=af(kt,js,Ne,Nn,Ae,Tt),ua=of(jp,Ae),Fp=Of(et,ua,te,tt,ve),Bp=xf(le,Ke,ua,Fp,ee,Y),$p=Lf(Nn,te,ve),Vp=Mf(le,ge,Nn,$p,ee,Y,jt),ha=yd(Ze),qi=Wh(Ze),da=new WeakMap,qp=td(da,lt),Up=ha?vu(Xe,Ae,qh(Ze),qi,zh(pu),ee,qp,Y,Os,new WeakMap,new WeakMap,Nf(Os,lt),Ze):void 0,Wp=gd(ji,Y),zp=xh(Bi,Xe,Ah,Vh,new WeakSet,ee,Wp,ln,xs,$i,Vi),fa=rh(Up,tp,sa,np,op,lp,hp,pp,gp,zp,yp,wp,Tp,Ep,xp,Ip,Dp,Lp,Bp,Vp),Gp=vd(le,Kd,ee,Y),Hp=bd(le,Yd,ee,Y),Jp=Td(le,Zd,ee,Y),Xp=Qd(ge,Y),Kp=kd(le,Xp,ee),Yp=Bu(fa,ge,Ae,Pf,Gp,Hp,Jp,Kp,$s),Ui=sd(oa),Zp=ku(Ui),pa=_h(Qe),Qp=Dh(Ui),ma=jh(Qe),ga=new WeakMap,em=Xh(ga,Je),tm=Bd(pa,Qe,ge,kt,js,ps,Ne,Fs,Ae,ma,qi,em,Tt),sm=Md(ge,tm,Ne,Ae,Tt),nm=ih(et,pa,fs,kt,js,ps,Ne,Qp,ma,qi,te,Os,lt,tt,ve,In),im=Qh(da),rm=Sf(ga),zr=ha?th(Zp,le,Ke,nm,sm,Ce,im,ee,Y,Os,qf,rm,Jf,ds):void 0,om=Eh(Ae,lt),am=Ef(Bi,Xe,Li,Ui,In,ln,$i,Vi),cm=hf(fa,Xe,ge,om,am),lm=ld(En,ji),um=ud(Ai,Fi),hm=hd(xi,ea),dm=dd(En,Y);function $e(n){return n===void 0}function H(n){return n!==void 0}function fm(n){return typeof n=="function"}function at(n){return typeof n=="number"}function Nt(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function _a(n){return typeof n=="boolean"}function He(n){return Array.isArray(n)}function ct(n){return typeof n=="string"}function en(n){return ct(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function q(n,e){if(!n)throw new Error(e)}function vt(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function ya(n){!n.isOffline&&n.state!=="running"&&Wi('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let va=!1,Gr=!1;function Hr(n){va=n}function pm(n){$e(n)&&va&&!Gr&&(Gr=!0,Wi("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let wa=console;function mm(...n){wa.log(...n)}function Wi(...n){wa.warn(...n)}function gm(n){return new Yp(n)}function _m(n,e,t){return new cm(n,e,t)}const Me=typeof self=="object"?self:null,ym=Me&&(Me.hasOwnProperty("AudioContext")||Me.hasOwnProperty("webkitAudioContext"));function vm(n,e,t){return q(H(zr),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof(Me==null?void 0:Me.BaseAudioContext)?Me==null?void 0:Me.AudioWorkletNode:zr)(n,e,t)}function Ye(n,e,t,s){var i=arguments.length,r=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,s);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r}function de(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?r(u.value):i(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})}class wm{constructor(e,t,s,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Dt(n){return hm(n)}function yt(n){return um(n)}function nn(n){return dm(n)}function Ht(n){return lm(n)}function bm(n){return n instanceof sa}function Tm(n,e){return n==="value"||Dt(e)||yt(e)||bm(e)}function Kt(n,...e){if(!e.length)return n;const t=e.shift();if(Nt(n)&&Nt(t))for(const s in t)Tm(s,t[s])?n[s]=t[s]:Nt(t[s])?(n[s]||Object.assign(n,{[s]:{}}),Kt(n[s],t[s])):Object.assign(n,{[s]:t[s]});return Kt(n,...e)}function km(n,e){return n.length===e.length&&n.every((t,s)=>e[s]===t)}function B(n,e,t=[],s){const i={},r=Array.from(e);if(Nt(r[0])&&s&&!Reflect.has(r[0],s)&&(Object.keys(r[0]).some(a=>Reflect.has(n,a))||(Kt(i,{[s]:r[0]}),t.splice(t.indexOf(s),1),r.shift())),r.length===1&&Nt(r[0]))Kt(i,r[0]);else for(let o=0;o<t.length;o++)H(r[o])&&(i[t[o]]=r[o]);return Kt(n,i)}function Sm(n){return n.constructor.getDefaults()}function Rt(n,e){return $e(n)?e:n}function Jr(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class ut{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Me&&this.toString()===Me.TONE_DEBUG_CLASS)&&mm(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ut.version=So;const zi=1e-6;function ts(n,e){return n>e+zi}function _i(n,e){return ts(n,e)||ze(n,e)}function gn(n,e){return n+zi<e}function ze(n,e){return Math.abs(n-e)<zi}function Cm(n,e,t){return Math.max(Math.min(n,t),e)}class Ve extends ut{constructor(){super(),this.name="Timeline",this._timeline=[];const e=B(Ve.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(q(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];q(_i(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const s=this._search(e,t);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const s=this._search(e,t);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const s=this._search(e);return s-1>=0?this._timeline[s-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(ze(this._timeline[t].time,e)){for(let s=t;s>=0&&ze(this._timeline[s].time,e);s--)t=s;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&_i(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let s=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;s<r;){let o=Math.floor(s+(r-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(ze(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(ze(u[t],e))o=l;else break}return o}else{if(gn(a[t],e)&&ts(c[t],e))return o;ts(a[t],e)?r=o:s=o+1}}return-1}_iterate(e,t=0,s=this._timeline.length-1){this._timeline.slice(t,s+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const s=this._search(e);return s!==-1&&this._iterate(t,0,s),this}forEachAfter(e,t){const s=this._search(e);return this._iterate(t,s+1),this}forEachBetween(e,t,s){let i=this._search(e),r=this._search(t);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(s,i,r)):i===-1&&this._iterate(s,0,r),this}forEachFrom(e,t){let s=this._search(e);for(;s>=0&&this._timeline[s].time>=e;)s--;return this._iterate(t,s+1),this}forEachAtTime(e,t){const s=this._search(e);if(s!==-1&&ze(this._timeline[s].time,e)){let i=s;for(let r=s;r>=0&&ze(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const ba=[];function Rn(n){ba.push(n)}function Em(n){ba.forEach(e=>e(n))}const Ta=[];function Pn(n){Ta.push(n)}function Am(n){Ta.forEach(e=>e(n))}class Vs extends ut{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{$e(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const s=(...i)=>{t(...i),this.off(e,s)};return this.on(e,s),this}off(e,t){return e.split(/\W+/).forEach(i=>{if($e(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if($e(t))this._events[i]=[];else{const r=this._events[i];for(let o=r.length-1;o>=0;o--)r[o]===t&&r.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const s=this._events[e].slice(0);for(let i=0,r=s.length;i<r;i++)s[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const s=Object.getOwnPropertyDescriptor(Vs.prototype,t);Object.defineProperty(e.prototype,t,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class ka extends Vs{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class qs extends ka{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Ve,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=B(qs.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=gm({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new wm(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Em(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,s){return this._context.createBuffer(e,t,s)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,s){return this._context.createPeriodicWave(e,t,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return q(Ht(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return q(Ht(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return q(Ht(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){q(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){q(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){q(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){q(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return vm(this.rawContext,e,t)}addAudioWorkletModule(e){return de(this,void 0,void 0,function*(){q(H(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return de(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Ht(this._context)?this._context.resume():Promise.resolve()}close(){return de(this,void 0,void 0,function*(){Ht(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Am(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),s=t.getChannelData(0);for(let r=0;r<s.length;r++)s[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,t=>{t.callback(),this._timeouts.remove(t)})}setTimeout(e,t){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:s+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const s=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:s,time:r+t})};return i(),s}}class xm extends ka{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,s){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return de(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function ce(n,e){He(e)?e.forEach(t=>ce(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function Sa(n,e){He(e)?e.forEach(t=>Sa(n,t)):Object.defineProperty(n,e,{writable:!0})}const X=()=>{};class Z extends ut{constructor(){super(),this.name="ToneAudioBuffer",this.onload=X;const e=B(Z.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,ct(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:X,onload:X,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Fe().sampleRate}set(e){return e instanceof Z?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return de(this,void 0,void 0,function*(){const t=Z.load(e).then(s=>{this.set(s),this.onload(this)});Z.downloads.push(t);try{yield t}finally{const s=Z.downloads.indexOf(t);Z.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=He(e)&&e[0].length>0,s=t?e.length:1,i=t?e[0].length:e.length,r=Fe(),o=r.createBuffer(s,i,r.sampleRate),a=!t&&s===1?[e]:e;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(at(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const s=this.numberOfChannels;for(let i=0;i<s;i++){const r=this.toArray(i);for(let o=0;o<r.length;o++)t[o]+=r[o]}t=t.map(i=>i/s),this.fromArray(t)}return this}toArray(e){if(at(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let s=0;s<this.numberOfChannels;s++)t[s]=this.getChannelData(s);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){q(this.loaded,"Buffer is not loaded");const s=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);q(s<i,"The start time must be less than the end time");const r=i-s,o=Fe().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,i),a);return new Z(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Z().fromArray(e)}static fromUrl(e){return de(this,void 0,void 0,function*(){return yield new Z().load(e)})}static load(e){return de(this,void 0,void 0,function*(){const t=Z.baseUrl===""||Z.baseUrl.endsWith("/")?Z.baseUrl:Z.baseUrl+"/",s=yield fetch(t+e);if(!s.ok)throw new Error(`could not load url: ${e}`);const i=yield s.arrayBuffer();return yield Fe().decodeAudioData(i)})}static supportsType(e){const t=e.split("."),s=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return de(this,void 0,void 0,function*(){for(yield Promise.resolve();Z.downloads.length;)yield Z.downloads[0]})}}Z.baseUrl="";Z.downloads=[];class Gi extends qs{constructor(){super({clockSource:"offline",context:nn(arguments[0])?arguments[0]:_m(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:nn(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=nn(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return de(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const s=Math.floor(this.sampleRate/128);e&&t%s===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return de(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Z(t)})}close(){return Promise.resolve()}}const Ca=new xm;let It=Ca;function Fe(){return It===Ca&&ym&&Om(new qs),It}function Om(n,e=!1){e&&It.dispose(),Ht(n)?It=new qs(n):nn(n)?It=new Gi(n):It=n}function Im(){return It.resume()}if(Me&&!Me.TONE_SILENCE_LOGGING){const e=` * Tone.js v${So} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Nm(n){return Math.pow(10,n/20)}function Rm(n){return 20*(Math.log(n)/Math.LN10)}function Ea(n){return Math.pow(2,n/12)}let Dn=440;function Pm(){return Dn}function Dm(n){Dn=n}function yi(n){return Math.round(Aa(n))}function Aa(n){return 69+12*Math.log2(n/Dn)}function Mm(n){return Dn*Math.pow(2,(n-69)/12)}class Hi extends ut{constructor(e,t,s){super(),this.defaultUnits="s",this._val=t,this._units=s,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const s=parseInt(e,10),i=t==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/s)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,s)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Hi&&this.fromType(this._val),$e(this._val))return this._noArg();if(ct(this._val)&&$e(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Nt(this._val)){let e=0;for(const t in this._val)if(H(this._val[t])){const s=this._val[t],i=new this.constructor(this.context,t).valueOf()*s;e+=i}return e}if(H(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return ct(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Ge extends Hi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Ge(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const s=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/s)*s-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const o=Math.pow(2,r);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let s=t[0],i=new Ge(this.context,t[0]).toSeconds();return t.forEach(r=>{const o=new Ge(this.context,r).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(s=r,i=o)}),s}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const s=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[s,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return yi(this.toFrequency())}_now(){return this.context.now()}}class Be extends Ge{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Pm()}static set A4(e){Dm(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Be.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=Lm[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Be.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,s){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s)/4)),i}}})}transpose(e){return new Be(this.context,this.valueOf()*Ea(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return yi(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Be.A4);let s=Math.round(12*t)+57;const i=Math.floor(s/12);return i<0&&(s+=-12*i),jm[s%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return Mm(e)}static ftom(e){return yi(e)}}const Lm={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},jm=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ss extends Ge{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class _e extends ut{constructor(){super();const e=B(_e.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Fe()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return pm(e),new Ge(this.context,e).toSeconds()}toFrequency(e){return new Be(this.context,e).toFrequency()}toTicks(e){return new Ss(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(s=>{$e(e[s])&&delete t[s]}),t}get(){const e=Sm(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const s=this[t];H(s)&&H(s.value)&&H(s.setValueAtTime)?e[t]=s.value:s instanceof _e?e[t]=s._getPartialProperties(e[t]):He(s)||at(s)||ct(s)||_a(s)?e[t]=s:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&H(this[t])&&(this[t]&&H(this[t].value)&&H(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof _e?this[t].set(e[t]):this[t]=e[t])}),this}}class Mn extends Ve{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,s){return vt(t,0),this.add(Object.assign({},s,{state:e,time:t})),this}getLastState(e,t){const s=this._search(t);for(let i=s;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const s=this._search(t);if(s!==-1)for(let i=s;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class re extends _e{constructor(){const e=B(re.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,q(H(e.param)&&(Dt(e.param)||e.param instanceof re),"param must be an AudioParam");!Dt(e.param);)e.param=e.param._param;this._swappable=H(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Ve(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,H(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(_e.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return H(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return H(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return H(this.maxValue)&&H(this.minValue)&&vt(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Nm(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Rm(e):e}setValueAtTime(e,t){const s=this.toSeconds(t),i=this._fromType(e);return q(isFinite(i)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,s),this._events.add({time:s,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,s),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),s=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(s===null)r=i.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,o,s.time,s.value,t):r=this._exponentialInterpolate(i.time,o,s.time,s.value,t)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const s=this._fromType(e),i=this.toSeconds(t);return q(isFinite(s)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this._events.add({time:i,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(s,i),this}exponentialRampToValueAtTime(e,t){let s=this._fromType(e);s=ze(s,0)?this._minOutput:s,this._assertRange(s);const i=this.toSeconds(t);return q(isFinite(s)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(s,i),this}exponentialRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(e,s+this.toSeconds(t)),this}linearRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(e,s+this.toSeconds(t)),this}targetRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(e,s,t),this}exponentialApproachValueAtTime(e,t,s){t=this.toSeconds(t),s=this.toSeconds(s);const i=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+s*.9),this.linearRampToValueAtTime(e,t+s),this}setTargetAtTime(e,t,s){const i=this._fromType(e);q(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),q(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:s,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,s),this._param.setTargetAtTime(i,r,s),this}setValueCurveAtTime(e,t,s,i=1){s=this.toSeconds(s),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const o=s/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return q(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),s=this._fromType(this.getValueAtTime(t));q(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+s);const i=this._events.get(t),r=this._events.getAfter(t);return i&&ze(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),t):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),t)),this._events.add({time:t,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,t),this}rampTo(e,t=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,s):this.linearRampTo(e,t,s),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const s=this._events.get(t);if(s&&s.type==="setTargetAtTime"){const i=this._events.getAfter(s.time),r=i?i.time:t+2,o=(r-t)/10;for(let a=t;a<r;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){q(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,s,i,r){return s+(t-s)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,s,i,r){return t+(i-t)*((r-e)/(s-e))}_exponentialInterpolate(e,t,s,i,r){return t*Math.pow(i/t,(r-e)/(s-e))}}class z extends _e{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return H(this.input)?Dt(this.input)||this.input instanceof re?1:this.input.numberOfInputs:0}get numberOfOutputs(){return H(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return H(e)&&(e instanceof z||yt(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();q(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,s=0){return ms(this,e,t,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Wi("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,s=0){return Fm(this,e,t,s),this}chain(...e){return vi(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),H(this.input)&&(this.input instanceof z?this.input.dispose():yt(this.input)&&this.input.disconnect()),H(this.output)&&(this.output instanceof z?this.output.dispose():yt(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function vi(...n){const e=n.shift();n.reduce((t,s)=>(t instanceof z?t.connect(s):yt(t)&&ms(t,s),s),e)}function ms(n,e,t=0,s=0){for(q(H(n),"Cannot connect from undefined node"),q(H(e),"Cannot connect to undefined node"),(e instanceof z||yt(e))&&q(e.numberOfInputs>0,"Cannot connect to node with no inputs"),q(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof z||e instanceof re;)H(e.input)&&(e=e.input);for(;n instanceof z;)H(n.output)&&(n=n.output);Dt(e)?n.connect(e,t):n.connect(e,t,s)}function Fm(n,e,t=0,s=0){if(H(e))for(;e instanceof z;)e=e.input;for(;!yt(n);)H(n.output)&&(n=n.output);Dt(e)?n.disconnect(e,t):yt(e)?n.disconnect(e,t,s):n.disconnect()}class be extends z{constructor(){const e=B(be.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new re({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),ce(this,"gain")}static getDefaults(){return Object.assign(z.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class ss extends z{constructor(e){super(e),this.onended=X,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new be({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const s=this.toSeconds(t);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(z.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:X})}_startGain(e,t=1){q(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=e+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+s):this._gainNode.gain.exponentialApproachValueAtTime(t,e,s)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){q(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==X&&(this.onended(this),this.onended=X,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),q(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=X,this}}class Ji extends ss{constructor(){const e=B(Ji.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ms(this._source,this._gainNode),this.offset=new re({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(ss.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ye extends z{constructor(){const e=B(ye.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new Ji({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(z.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,s=0){return Xi(this,e,t,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,s){return this._param.exponentialRampTo(e,t,s),this}linearRampTo(e,t,s){return this._param.linearRampTo(e,t,s),this}targetRampTo(e,t,s){return this._param.targetRampTo(e,t,s),this}exponentialApproachValueAtTime(e,t,s){return this._param.exponentialApproachValueAtTime(e,t,s),this}setTargetAtTime(e,t,s){return this._param.setTargetAtTime(e,t,s),this}setValueCurveAtTime(e,t,s,i){return this._param.setValueCurveAtTime(e,t,s,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,s){return this._param.rampTo(e,t,s),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Xi(n,e,t,s){(e instanceof re||Dt(e)||e instanceof ye&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ye&&(e.overridden=!0)),ms(n,e,t,s)}class Ki extends re{constructor(){const e=B(Ki.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Ve(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(re.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,s){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+t,l=this._exponentialApproach(r.time,r.value,i,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const s=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const s=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(s),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,s);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const s=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/r;for(let a=0;a<=r;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if($e(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const s=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(s+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),s=this._events.get(t);return Math.max(this._getTicksUntilEvent(s,t),0)}getDurationOfTicks(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-s}getTimeOfTick(e){const t=this._events.get(e,"ticks"),s=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&s&&s.type==="linearRampToValueAtTime"&&t.value!==s.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(s.time))-i)/(s.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const s=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(s);return this.getTicksAtTime(s+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Yi extends ye{constructor(){const e=B(Yi.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new Ki({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ye.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class Zi extends _e{constructor(){const e=B(Zi.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new Mn,this._tickOffset=new Ve,this._ticksAtTime=new Ve,this._secondsAtTime=new Ve,this.frequency=new Yi({context:this.context,units:e.units,value:e.frequency}),ce(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},_e.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const s=this.toSeconds(e);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),H(t)&&this.setTicksAtTime(t,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const s=this._state.get(t);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),s=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),r={state:"paused",time:t};this._state.add(r);let o=i||s,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==r.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(r),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),s=this.frequency.timeToTicks(e,t);this.setTicksAtTime(s,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);const i=this._secondsAtTime.get(e);let r=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let l=r.time;const u=this._tickOffset.get(c.time);u&&u.time>=r.time&&(o=u.seconds,l=u.time),r.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==s.time&&(a={state:c.state,time:c.time,seconds:o})),r=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const s=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(s.time,i.time),o=this.frequency.getTicksAtTime(r)+e-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,s){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,s),i=o});let r=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=ze(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(d){r=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Ln extends _e{constructor(){const e=B(Ln.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=X,this._lastUpdate=0,this._state=new Mn("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new Zi({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ce(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(_e.getDefaults(),{callback:X,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){ya(this.context);const s=this.toSeconds(e);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,t),s<this._lastUpdate&&this.emit("start",s,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const s=this.toSeconds(t),i=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(i+e,s)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,s=>{switch(s.state){case"started":const i=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,i);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(e,t,(s,i)=>{this.callback(s,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Vs.mixin(Ln);class gs extends z{constructor(){const e=B(gs.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new be({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,ce(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(z.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Qi extends z{constructor(){const e=B(Qi.getDefaults(),arguments);super(e),this.name="Destination",this.input=new gs({context:this.context}),this.output=new be({context:this.context}),this.volume=this.input.volume,vi(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(z.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),vi(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Rn(n=>{n.destination=new Qi({context:n})});Pn(n=>{n.destination.dispose()});class Bm extends z{constructor(){super(...arguments),this.name="Listener",this.positionX=new re({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new re({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new re({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new re({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new re({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new re({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new re({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new re({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new re({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(z.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Rn(n=>{n.listener=new Bm({context:n})});Pn(n=>{n.listener.dispose()});class er extends ut{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=B(er.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const s=e.urls[t];this.add(t,s,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:X,onload:X,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return q(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,s=X,i=X){return ct(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Z(this.baseUrl+t,s,i))):this._buffers.set(e.toString(),new Z(t,s,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class je extends Ss{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class $m extends _e{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ve,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,t=>{e-t.time<=this.expiration&&t.callback(),this._events.remove(t)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Rn(n=>{n.draw=new $m({context:n})});Pn(n=>{n.draw.dispose()});class Vm extends ut{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){q(H(e.time),"Events must have a time property"),q(H(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new qm(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const s of t)if(s.event===e){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let s,i=null;if(t>0)if(e.left.right===null)s=e.left,s.right=e.right,i=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,i=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,i=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,i=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,s=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,s=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?s?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let s=t[0];for(let i=1;i<t.length;i++)t[i].low>s.low&&(s=t[i]);return s.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(s=>t.push(s)),t.forEach(s=>{s.event&&e(s.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const s=[];this._root.search(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const s=[];this._root.searchAfter(e,s),s.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class qm{constructor(e,t,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Um extends ut{constructor(e){super(),this.name="TimelineValue",this._timeline=new Ve({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class ns extends z{constructor(){super(B(ns.getDefaults(),arguments,["context"]))}connect(e,t=0,s=0){return Xi(this,e,t,s),this}}class Us extends ns{constructor(){const e=B(Us.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,He(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):fm(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ye.getDefaults(),{length:1024})}setMap(e,t=1024){const s=new Float32Array(t);for(let i=0,r=t;i<r;i++){const o=i/(r-1)*2-1;s[i]=e(o,i)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(s=>s.includes(e));q(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class tr extends ns{constructor(){const e=B(tr.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new Us({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(ns.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class wt{constructor(e,t){this.id=wt._eventId++,this._remainderTime=0;const s=Object.assign(wt.getDefaults(),t);this.transport=e,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:X,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}wt._eventId=0;class sr extends wt{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(sr.getDefaults(),t);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},wt.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return gn(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new je(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){gn(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new je(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);ts(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class jn extends _e{constructor(){const e=B(jn.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new Um(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ve,this._repeatedEvents=new Vm,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new Ln({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),ce(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(_e.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const s=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(s*Math.PI)*this._swingAmount;e+=new je(this.context,this._swingTicks*2/3).toSeconds()*i}Hr(!0),this._timeline.forEachAtTime(t,s=>s.invoke(e)),Hr(!1)}schedule(e,t){const s=new wt(this,{callback:e,time:new Ss(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(e,t,s,i=1/0){const r=new sr(this,{callback:e,duration:new Ge(this.context,i).toTicks(),interval:new Ge(this.context,t).toTicks(),time:new Ss(this.context,s).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const s=new wt(this,{callback:e,once:!0,time:new Ss(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(t,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new je(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let s;return H(t)&&(s=this.toTicks(t)),this._clock.start(e,s),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){He(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Ge(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Ge(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new je(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new je(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),s=this._clock.frequency.timeToTicks(e,t);this.ticks=s}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,t),r=t+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),s=this.getTicksAtTime(t),i=e-s%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const s=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(s)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/r,l=new be(c),u=new tr(-1),h=new be(c);i.chain(l,u,h),i=h,r=1/r,o=[l,u,h]}t||(e.getValueAtTime(s)!==0?t=e.getValueAtTime(s)/r:t=0);const a=new be(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const s=this._syncedSignals[t];s.signal===e&&(s.nodes.forEach(i=>i.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Sa(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Vs.mixin(jn);Rn(n=>{n.transport=new jn({context:n})});Pn(n=>{n.transport.dispose()});class Ee extends z{constructor(e){super(e),this.input=void 0,this._state=new Mn("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=X,this._syncedStop=X,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new gs({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,ce(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(z.getDefaults(),{mute:!1,onstop:X,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,s){let i=$e(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")q(ts(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,s);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Rt(t,0)),r.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,s)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else ya(this.context),this._start(i,t,s);return this}stop(e){let t=$e(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||H(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const s=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(s)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,s){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(ts(t,0)){const s=this._state.get(t);if(s&&s.state==="started"&&s.time!==t){const i=t-this.toSeconds(s.time);let r;s.duration&&(r=this.toSeconds(s.duration)-i),this._start(e,this.toSeconds(s.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=X,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Ws extends ss{constructor(){const e=B(Ws.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ms(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new re({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Z(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(ss.getDefaults(),{url:new Z,loop:!1,loopEnd:0,loopStart:0,onload:X,onerror:X,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,s,i=1){q(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?t=Rt(t,this.loopStart):t=Rt(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;_i(o,a)&&(o=(o-c)%l+c),ze(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,gn(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),H(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(r+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Cs extends Ee{constructor(){const e=B(Cs.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ee.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(q(e in Xr,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=Xr[this._type];this._source=new Ws({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const zt=44100*5,Qn=2,st={brown:null,pink:null,white:null},Xr={get brown(){if(!st.brown){const n=[];for(let e=0;e<Qn;e++){const t=new Float32Array(zt);n[e]=t;let s=0;for(let i=0;i<zt;i++){const r=Math.random()*2-1;t[i]=(s+.02*r)/1.02,s=t[i],t[i]*=3.5}}st.brown=new Z().fromArray(n)}return st.brown},get pink(){if(!st.pink){const n=[];for(let e=0;e<Qn;e++){const t=new Float32Array(zt);n[e]=t;let s,i,r,o,a,c,l;s=i=r=o=a=c=l=0;for(let u=0;u<zt;u++){const h=Math.random()*2-1;s=.99886*s+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=s+i+r+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}st.pink=new Z().fromArray(n)}return st.pink},get white(){if(!st.white){const n=[];for(let e=0;e<Qn;e++){const t=new Float32Array(zt);n[e]=t;for(let s=0;s<zt;s++)t[s]=Math.random()*2-1}st.white=new Z().fromArray(n)}return st.white}};function Ft(n,e){return de(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,s=new Gi(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class nr extends ss{constructor(){const e=B(nr.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ms(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new re({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new re({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),ce(this,["frequency","detune"])}static getDefaults(){return Object.assign(ss.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class he extends Ee{constructor(){const e=B(he.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),ce(this,"frequency"),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),ce(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Ee.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),s=new nr({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return he._periodicWaveCache.find(t=>t.phase===this._phase&&km(t.partials,this._partials));{const e=he._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const s=this._getCachedPeriodicWave();if(H(s)){const{partials:i,wave:r}=s;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,r);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),he._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),he._periodicWaveCache.length>100&&he._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){vt(e,0);let t=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(t=s[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,o)=>i[o]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const r=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[r,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(r[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(r[c]=0,o[c]=0)}return[r,o]}_inverseFFT(e,t,s){let i=0;const r=e.length;for(let o=0;o<r;o++)i+=e[o]*Math.cos(o*s)+t[o]*Math.sin(o*s);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let s=0;const i=Math.PI*2,r=32;for(let o=0;o<r;o++)s=Math.max(this._inverseFFT(e,t,o/r*i),s);return Cm(-this._inverseFFT(e,t,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}he._periodicWaveCache=[];class Wm extends ns{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Us({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class is extends ye{constructor(){const e=B(is.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new be({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ye.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Fn extends Ee{constructor(){const e=B(Fn.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new Wm({context:this.context}),this._modulationNode=new be({context:this.context}),this._carrier=new he({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new he({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new is({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ce(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(he.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Bn extends Ee{constructor(){const e=B(Bn.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new be({context:this.context,gain:0}),this._carrier=new he({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new he({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new is({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new is({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ce(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(he.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class zs extends Ee{constructor(){const e=B(zs.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new be({context:this.context,gain:0}),this._thresh=new Us({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new ye({context:this.context,units:"audioRange",value:e.width}),this._triangle=new he({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ce(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Ee.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class $n extends Ee{constructor(){const e=B($n.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,ce(this,["frequency","detune"])}static getDefaults(){return Object.assign(he.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,s=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+s*r)}}get count(){return this._oscillators.length}set count(e){if(vt(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const s=new he({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):X});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[t]=s}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,s)=>t.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Vn extends Ee{constructor(){const e=B(Vn.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new is({context:this.context,value:2}),this._pulse=new zs({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new he({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ce(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Ee.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Kr={am:Fn,fat:$n,fm:Bn,oscillator:he,pulse:zs,pwm:Vn};class _n extends Ee{constructor(){const e=B(_n.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new ye({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ye({context:this.context,units:"cents",value:e.detune}),ce(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(he.getDefaults(),Bn.getDefaults(),Fn.getDefaults(),$n.getDefaults(),zs.getDefaults(),Vn.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=Kr[e],s=this.now();if(this._oscillator){const i=this._oscillator;i.stop(s),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof Kr[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&at(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&at(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ct(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function xa(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){vt(r,n,e),t.set(this,r)}})}}function ht(n,e=1/0){const t=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){vt(this.toSeconds(r),n,e),t.set(this,r)}})}}class qn extends Ee{constructor(){const e=B(qn.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Z({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ee.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:X,onerror:X,playbackRate:1,reverse:!1})}load(e){return de(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=X){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,s){return super.start(e,t,s),this}_start(e,t,s){this._loop?t=Rt(t,this._loopStart):t=Rt(t,0);const i=this.toSeconds(t),r=s;s=Rt(s,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(s);o=o/this._playbackRate,e=this.toSeconds(e);const a=new Ws({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&$e(r)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(s=>s.stop(t))}restart(e,t,s){return super.restart(e,t,s),this}_restart(e,t,s){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,s)}seek(e,t){const s=this.toSeconds(t);if(this._state.getValueAtTime(s)==="started"){const i=this.toSeconds(e);this._stop(s),this._start(s,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&vt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&vt(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),s=this._state.getNextState("stopped",t);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Ye([ht(0)],qn.prototype,"fadeIn",void 0);Ye([ht(0)],qn.prototype,"fadeOut",void 0);class St extends z{constructor(){const e=B(St.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new ye({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(z.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(ct(e))return e;{let s;for(s in tn)if(tn[s][t]===e)return s;return e}}_setCurve(e,t,s){if(ct(s)&&Reflect.has(tn,s)){const i=tn[s];Nt(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(He(s)&&e!=="_decayCurve")this[e]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(r&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,r+c):this._sig.exponentialApproachValueAtTime(a,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,e):(q(He(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,s,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,s=1){return t=this.toSeconds(t),this.triggerAttack(t,s),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,s=0){return Xi(this,e,t,s),this}asArray(){return de(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,s=new Gi(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),o=r*.1,a=r+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Ye([ht(0)],St.prototype,"attack",void 0);Ye([ht(0)],St.prototype,"decay",void 0);Ye([xa(0,1)],St.prototype,"sustain",void 0);Ye([ht(0)],St.prototype,"release",void 0);const tn=(()=>{let e,t;const s=[];for(e=0;e<128;e++)s[e]=Math.sin(e/127*(Math.PI/2));const i=[],r=6.4;for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(Math.PI*2)*r-Math.PI/2)+1;i[e]=d/10+t*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(f*(1-t))}function u(d){const f=new Array(d.length);for(let p=0;p<d.length;p++)f[p]=1-d[p];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class rs extends z{constructor(){const e=B(rs.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new gs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,ce(this,"volume")}static getDefaults(){return Object.assign(z.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const s=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[t],o=this.context.transport.schedule(a=>{i[t]=a,s.apply(this,i)},r);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,s,i){const r=this.toSeconds(s),o=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class os extends rs{constructor(){const e=B(os.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(rs.getDefaults(),{detune:0,onsilence:X,portamento:0})}triggerAttack(e,t,s=1){this.log("triggerAttack",e,t,s);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,s),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const s=this.toSeconds(t),i=e instanceof Be?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,s)}else this.frequency.setValueAtTime(i,s);return this}}Ye([ht(0)],os.prototype,"portamento",void 0);class ir extends St{constructor(){super(B(ir.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new be({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Is extends os{constructor(){const e=B(Is.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new _n(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ir(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),ce(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(os.getDefaults(),{envelope:Object.assign(Jr(St.getDefaults(),Object.keys(z.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Jr(_n.getDefaults(),[...Object.keys(Ee.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Gs extends Is{constructor(){const e=B(Gs.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,ce(this,["oscillator","envelope"])}static getDefaults(){return Kt(os.getDefaults(),Is.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const s=this.toSeconds(t),i=this.toFrequency(e instanceof Be?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,s),this.oscillator.frequency.exponentialRampToValueAtTime(i,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Ye([xa(0)],Gs.prototype,"octaves",void 0);Ye([ht(0)],Gs.prototype,"pitchDecay",void 0);const Oa=new Set;function rr(n){Oa.add(n)}function Ia(n,e){const t=`registerProcessor("${n}", ${e})`;Oa.add(t)}const zm=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;rr(zm);const Gm=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;rr(Gm);const Hm=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;rr(Hm);const Jm="feedback-comb-filter",Xm=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Ia(Jm,Xm);class Un extends rs{constructor(){const e=B(Un.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(s=>{const i=parseInt(s,10);if(q(en(s)||at(i)&&isFinite(i),`url key is neither a note or midi pitch: ${s}`),en(s)){const r=new Be(this.context,s).toMidi();t[r]=e.urls[s]}else at(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new er({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(rs.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:X,onerror:X,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,s=1){return this.log("triggerAttack",e,t,s),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=Aa(new Be(this.context,i).toFrequency()),o=Math.round(r),a=r-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=Ea(c+a),d=new Ws({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,s),He(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const f=this._activeSources.get(o),p=f.indexOf(d);p!==-1&&f.splice(p,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=new Be(this.context,s).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,s,i=1){const r=this.toSeconds(s);return this.triggerAttack(e,r,i),He(t)?(q(He(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,s){if(q(en(e)||isFinite(e),`note must be a pitch or midi: ${e}`),en(e)){const i=new Be(this.context,e).toMidi();this._buffers.add(i,t,s)}else this._buffers.add(e,t,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Ye([ht(0)],Un.prototype,"attack",void 0);Ye([ht(0)],Un.prototype,"release",void 0);class or extends _e{constructor(){const e=B(or.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new Mn("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(_e.getDefaults(),{callback:X,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,t=>{let s;if(t.state==="started"){t.id!==-1&&this.context.transport.clear(t.id);const i=t.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||at(this._loop)&&this._loop>1){s=1/0,at(this._loop)&&(s=this._loop*this._getLoopDuration());const r=this._state.getAfter(i);r!==null&&(s=Math.min(s,r.time-i)),s!==1/0&&(s=new je(this.context,s));const o=new je(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new je(this.context,i),s)}else t.id=this.context.transport.schedule(this._tick.bind(this),new je(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const t=this.toTicks(e);return this._state.getValueAtTime(t)==="stopped"&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}stop(e){this.cancel(e);const t=this.toTicks(e);if(this._state.getValueAtTime(t)==="started"){this._state.setStateAtTime("stopped",t,{id:-1});const s=this._state.getBefore(t);let i=t;s!==null&&(i=s.time),this._rescheduleEvents(i)}return this}cancel(e){e=Rt(e,-1/0);const t=this.toTicks(e);return this._state.forEachFrom(t,s=>{this.context.transport.clear(s.id)}),this._state.cancel(t),this}_tick(e){const t=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(t)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let s=.02;_a(this.humanize)||(s=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*s}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new je(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new je(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,t=this._state.get(e);if(t!==null&&t.state==="started"){const s=this._getLoopDuration();return(e-t.time)%s/s}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class yn extends _e{constructor(){const e=B(yn.getDefaults(),arguments,["callback","interval"]);super(e),this.name="Loop",this._event=new or({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability,humanize:e.humanize}),this.callback=e.callback,this.iterations=e.iterations}static getDefaults(){return Object.assign(_e.getDefaults(),{interval:"4n",callback:X,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(e){return this._event.start(e),this}stop(e){return this._event.stop(e),this}cancel(e){return this._event.cancel(e),this}_tick(e){this.callback(e)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(e){this._event.loopEnd=e}get playbackRate(){return this._event.playbackRate}set playbackRate(e){this._event.playbackRate=e}get humanize(){return this._event.humanize}set humanize(e){this._event.humanize=e}get probability(){return this._event.probability}set probability(e){this._event.probability=e}get mute(){return this._event.mute}set mute(e){this._event.mute=e}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(e){e===1/0?this._event.loop=!0:this._event.loop=e}dispose(){return super.dispose(),this._event.dispose(),this}}class ar extends z{constructor(){const e=B(ar.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new re({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",ce(this,"pan")}static getDefaults(){return Object.assign(z.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Km="bit-crusher",Ym=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Ia(Km,Ym);class ue extends z{constructor(){const e=B(ue.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new be({context:this.context}),ue._allSolos.has(this.context)||ue._allSolos.set(this.context,new Set),ue._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(z.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),ue._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){ue._soloed.has(this.context)||ue._soloed.set(this.context,new Set),ue._soloed.get(this.context).add(this)}_removeSolo(){ue._soloed.has(this.context)&&ue._soloed.get(this.context).delete(this)}_isSoloed(){return ue._soloed.has(this.context)&&ue._soloed.get(this.context).has(this)}_noSolos(){return!ue._soloed.has(this.context)||ue._soloed.has(this.context)&&ue._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),ue._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ue._allSolos=new Map;ue._soloed=new Map;class cr extends z{constructor(){const e=B(cr.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new ar({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new gs({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,ce(this,["pan","volume"])}static getDefaults(){return Object.assign(z.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Xt extends z{constructor(){const e=B(Xt.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new ue({solo:e.solo,context:this.context}),this._panVol=this.output=new cr({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ce(this,["pan","volume"])}static getDefaults(){return Object.assign(z.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Xt.buses.has(e)||Xt.buses.set(e,new be({context:this.context})),Xt.buses.get(e)}send(e,t=0){const s=this._getBus(e),i=new be({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(s),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Xt.buses=new Map;function Zm(){return Fe().now()}const Yr=Fe().transport;Fe().destination;Fe().destination;Fe().listener;Fe().draw;Fe();ru.addListener("appUrlOpen",({url:n})=>{if(n&&n.startsWith("focusmatrix://auth-callback")){const e=n.replace("focusmatrix://auth-callback","https://dummy.local/");window.location.replace(e)}});const Qm="https://mzxeyosjcunoucmjgvln.supabase.co",eg="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16eGV5b3NqY3Vub3VjbWpndmxuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzOTgyODIsImV4cCI6MjA2Nzk3NDI4Mn0.kXdS6Pvxt6Q62G5IOo_NZhc2jinTM7swfc7MfBxsJvE",De=Xl(Qm,eg);class tg{constructor(e){this.app=e,this.isInitialized=!1,this.sounds={},this.activeSound=null}async init(){if(this.isInitialized)return!0;try{return await Im(),console.log(" Audio context started."),this.sounds.complete=new Is({oscillator:{type:"sine"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}}).toDestination(),this.sounds.tick=new Gs({pitchDecay:.008,octaves:2,envelope:{attack:.001,decay:.2,sustain:0}}).toDestination(),this.sounds.tick.volume.value=-18,this.sounds.white=new Cs("white").toDestination(),this.sounds.pink=new Cs("pink").toDestination(),this.sounds.brown=new Cs("brown").toDestination(),[this.sounds.white,this.sounds.pink,this.sounds.brown].forEach(e=>e.volume.value=-20),this.isInitialized=!0,!0}catch(e){return console.error("Failed to initialize Tone.js:",e),!1}}playSound(e){!this.isInitialized||!this.app.settings.soundEnabled||!this.sounds[e]||e==="complete"&&this.sounds.complete.triggerAttackRelease("C5","8n",Zm())}updateSoundscape(){if(this.stopSoundscape(),!this.isInitialized||!this.app.settings.soundEnabled)return;const e=this.app.settings.soundscape;e!=="none"&&(e==="ticking"?this.activeSound=new yn(t=>{this.sounds.tick.triggerAttackRelease("C4","32n",t)},"1s").start(0):this.sounds[e]&&(this.activeSound=this.sounds[e]),this.activeSound&&(this.activeSound.start(),Yr.start()))}stopSoundscape(){this.activeSound&&(this.activeSound.stop(),this.activeSound instanceof yn&&this.activeSound.dispose(),this.activeSound=null,Yr.stop())}}class sg{constructor(e){this.app=e,this.container=document.getElementById("authContainer"),this.form=document.getElementById("authForm"),this.emailInput=document.getElementById("authEmail"),this.passwordInput=document.getElementById("authPassword"),this.loginBtn=document.getElementById("loginBtn"),this.signupBtn=document.getElementById("signupBtn"),this.resetLink=document.getElementById("resetPasswordLink"),this.feedback=document.getElementById("authFeedback"),this.authPromise=new Promise(t=>{this.resolveAuth=t})}show(){this.container.style.display="flex"}hide(){this.container.style.display="none"}bindEvents(){this.form.addEventListener("submit",async e=>{e.preventDefault(),this.setLoading(!0);const{data:t,error:s}=await De.auth.signInWithPassword({email:this.emailInput.value,password:this.passwordInput.value});s?this.showFeedback(s.message,"error"):t.user&&(this.showFeedback("Success! Loading your matrix...","success"),this.app.user=t.user,this.resolveAuth(t.user),setTimeout(()=>this.hide(),1e3)),this.setLoading(!1)}),this.signupBtn.addEventListener("click",async()=>{this.setLoading(!0);const{data:e,error:t}=await De.auth.signUp({email:this.emailInput.value,password:this.passwordInput.value});t?this.showFeedback(t.message,"error"):this.showFeedback("Success! Check your email for a confirmation link.","success"),this.setLoading(!1)}),this.resetLink.addEventListener("click",async e=>{e.preventDefault();const t=this.emailInput.value;if(!t){this.showFeedback("Please enter your email address first.","error");return}this.setLoading(!0);const{error:s}=await De.auth.resetPasswordForEmail(t,{redirectTo:"https://pomodoro.thepi.es"});s?this.showFeedback(s.message,"error"):this.showFeedback("Password reset link sent! Check your email.","success"),this.setLoading(!1)})}showFeedback(e,t="info"){this.feedback.textContent=e,this.feedback.className=`auth-feedback ${t}`,this.feedback.style.display="block"}setLoading(e){this.loginBtn.disabled=e,this.signupBtn.disabled=e,this.loginBtn.textContent=e?"...":"Log In"}}class ng{constructor(){this.tasks=[],this.settings={theme:"auto",fontSize:16,animationSpeed:"normal",soundEnabled:!1,achievementsEnabled:!0,focusDuration:25,shortBreakDuration:5,longBreakDuration:30,sessionsPerCycle:4,goals:[],soundscape:"none",tickingEnabled:!1},this.stats={tasksAddedToday:0,tasksCompletedToday:0,tasksEliminatedToday:0,focusSessionsToday:0,dailyStreak:0,focusStreak:0,totalEliminated:0,lastUsedDate:null,achievements:{firstStep:!1,focusStarter:!1,goodJudgment:!1}},this.user=null,this.draggedTask=null,this.focusMode=!1,this.progressMode=!1,this.authManager=new sg(this),this.audioManager=new tg(this),this.focusedTask=null,this.handleLogout=async()=>{const{error:e}=await De.auth.signOut();e?(console.error("Error logging out:",e),this.showFeedback("Error logging out. Please try again.","error")):window.location.reload()},this.timerRunning=!1,this.focusTimer=null,this.timeRemaining=this.settings.focusDuration*60,this.timerMode="focus",this.currentCycle=1,this.touchStartX=0,this.touchStartY=0,this.touchStartTime=0,this.swipeThreshold=60,this.tapThreshold=250,this.init()}async init(){this.authManager.bindEvents();const{data:{session:e}}=await De.auth.getSession();e!=null&&e.user?this.user=e.user:(this.authManager.show(),this.user=await this.authManager.authPromise),document.getElementById("logoutBtn").style.display="inline-flex",await this.loadSettings(),await this.loadStats(),await this.loadTasks(),this.applySettings(),this.bindEvents(),this.renderAllTasks(),this.updateGoalSelect(),this.updateDashboard(),this.checkDailyReset(),this.requestNotificationPermission()}bindEvents(){document.getElementById("addTaskBtn").addEventListener("click",()=>this.handleAddTask()),document.getElementById("taskInput").addEventListener("keypress",e=>{e.key==="Enter"&&this.handleAddTask()}),document.getElementById("progressToggle").addEventListener("click",()=>this.toggleProgressDashboard()),document.getElementById("focusToggle").addEventListener("click",()=>this.toggleFocusMode()),document.getElementById("exportBtn").addEventListener("click",()=>this.quickExport()),document.getElementById("settingsBtn").addEventListener("click",()=>this.openSettings()),document.getElementById("logoutBtn").addEventListener("click",()=>this.handleLogout()),document.querySelectorAll(".focus-quadrant-btn").forEach(e=>{e.addEventListener("click",()=>{this.startFocusOnQuadrant(parseInt(e.dataset.quadrant,10))})}),this.bindTimerEvents(),this.bindSettingsEvents(),this.bindDataManagementEvents(),document.querySelectorAll(".task-list").forEach(e=>{e.addEventListener("dragover",t=>this.handleDragOver(t)),e.addEventListener("drop",t=>this.handleDrop(t)),e.addEventListener("dragenter",t=>this.handleDragEnter(t)),e.addEventListener("dragleave",t=>this.handleDragLeave(t))}),document.addEventListener("keydown",e=>this.handleKeyboard(e))}renderTask(e){const t=document.createElement("div");t.className="task-item",t.draggable=!0,t.dataset.taskId=e.id;const s=e.goal?`<span class="goal-badge" title="${this.escapeHtml(e.goal)}"> ${this.escapeHtml(e.goal)}</span>`:"";t.innerHTML=`<div class="task-text">${this.escapeHtml(e.text)} ${s}</div><div class="task-actions"><button class="task-action-btn focus-task-btn" aria-label="Focus on this task"></button><button class="task-action-btn delete-btn" aria-label="Delete"></button></div>`,t.addEventListener("dragstart",i=>{this.draggedTask=e,i.currentTarget.classList.add("dragging")}),t.addEventListener("dragend",i=>i.currentTarget.classList.remove("dragging")),t.addEventListener("dblclick",()=>this.editTask(e)),t.querySelector(".focus-task-btn").addEventListener("click",i=>{i.stopPropagation(),this.startFocusOnTask(e)}),t.querySelector(".delete-btn").addEventListener("click",i=>{i.stopPropagation(),this.deleteTask(e.id)}),t.addEventListener("touchstart",i=>this.handleTouchStart(i)),t.addEventListener("touchmove",i=>this.handleTouchMove(i,t)),t.addEventListener("touchend",i=>this.handleTouchEnd(i,e,t)),document.getElementById(`q${e.quadrant}-tasks`).appendChild(t),this.updateEmptyStates()}startFocusOnQuadrant(e){const t=this.tasks.find(s=>s.quadrant===e);t?this.startFocusOnTask(t):this.showFeedback(`Quadrant ${e} has no tasks to focus on.`,"info")}startFocusOnTask(e){this.focusedTask=e,document.getElementById("timerTaskText").textContent=e.text,document.getElementById("matrixContainer").classList.add("focus-active"),document.querySelectorAll(".quadrant").forEach(s=>s.classList.remove("is-focus-target")),document.querySelector(`.quadrant[data-quadrant="${e.quadrant}"]`).classList.add("is-focus-target"),this.setTimerMode("focus",!0),this.toggleFocusMode(),this.startTimer()}endFocusSession(){this.focusedTask=null,document.getElementById("timerTaskText").textContent="Ready for the next challenge!",document.getElementById("matrixContainer").classList.remove("focus-active"),document.querySelectorAll(".quadrant").forEach(e=>e.classList.remove("is-focus-target")),this.audioManager.stopSoundscape(),this.audioManager.stopTicking()}showTriageModal(){const e=document.getElementById("triageModal");if(!this.focusedTask)return;document.getElementById("triageTaskText").textContent=this.focusedTask.text,e.style.display="flex";const t=document.getElementById("triageCompleteBtn"),s=document.getElementById("triageIncompleteBtn"),i=async()=>{this.focusedTask&&await this.deleteTask(this.focusedTask.id),o()},r=()=>{o()},o=()=>{t.removeEventListener("click",i),s.removeEventListener("click",r),e.style.display="none",this.endFocusSession(),this.stats.focusSessionsToday++,this.saveStats(),this.updateDashboard(),this.checkAchievements(),this.showFeedback("Focus session complete!","success"),this.currentCycle%this.settings.sessionsPerCycle===0?this.setTimerMode("longBreak"):this.setTimerMode("shortBreak"),this.currentCycle++,this.startTimer()};t.addEventListener("click",i,{once:!0}),s.addEventListener("click",r,{once:!0})}async startTimer(){if(this.timerRunning)return;const e=await this.audioManager.init();this.timerRunning=!0,document.getElementById("startTimer").style.display="none",document.getElementById("pauseTimer").style.display="inline-block",e&&this.timerMode==="focus"&&this.audioManager.startTicking(),this.focusTimer=setInterval(()=>{this.timerRunning&&(this.timeRemaining=Math.max(0,this.timeRemaining-1),this.updateTimerDisplay(),this.timeRemaining===0&&this.timerComplete())},1e3)}pauseTimer(){this.timerRunning&&(clearInterval(this.focusTimer),this.timerRunning=!1,document.getElementById("startTimer").style.display="inline-block",document.getElementById("pauseTimer").style.display="none",this.audioManager.stopTicking())}timerComplete(){this.pauseTimer(),this.playSound("complete"),this.timerMode==="focus"&&this.focusedTask?this.showTriageModal():(this.timerMode==="focus"?(this.stats.focusSessionsToday++,this.saveStats(),this.updateDashboard(),this.checkAchievements(),this.showFeedback("Focus session complete!","success")):this.showFeedback("Break finished. Time to focus!","info"),this.currentCycle%this.settings.sessionsPerCycle===0&&this.timerMode==="focus"?this.setTimerMode("longBreak"):this.timerMode==="focus"?this.setTimerMode("shortBreak"):this.setTimerMode("focus"),this.currentCycle=this.timerMode==="focus"?this.currentCycle:this.currentCycle+1,this.startTimer()),Notification.permission==="granted"&&new Notification("FocusMatrix Timer",{body:this.timerMode==="focus"?"Time for a break!":"Break is over!",icon:"icons/icon-192x192.png"})}toggleFocusMode(){this.focusMode=!this.focusMode,document.body.classList.toggle("focus-mode",this.focusMode),this.focusMode?this.audioManager.startSoundscape():(this.timerRunning&&this.pauseTimer(),this.endFocusSession())}applySettings(){document.documentElement.style.setProperty("--font-size-base",this.settings.fontSize+"px");const e={none:"0s",slow:"0.5s",normal:"0.2s",fast:"0.1s"};document.documentElement.style.setProperty("--transition-speed",e[this.settings.animationSpeed]||"0.2s"),this.setTimerMode(this.timerMode,!0),this.focusMode?this.audioManager.startSoundscape():this.audioManager.stopSoundscape()}populateSettingsModal(){document.getElementById("themeSelect").value=this.settings.theme,document.getElementById("fontSizeSlider").value=this.settings.fontSize,document.getElementById("fontSizeValue").textContent=this.settings.fontSize+"px",document.getElementById("animationSpeed").value=this.settings.animationSpeed,document.getElementById("focusDuration").value=this.settings.focusDuration,document.getElementById("shortBreakDuration").value=this.settings.shortBreakDuration,document.getElementById("longBreakDuration").value=this.settings.longBreakDuration,document.getElementById("sessionsPerCycle").value=this.settings.sessionsPerCycle,document.getElementById("achievementsEnabled").checked=this.settings.achievementsEnabled,document.getElementById("soundEnabled").checked=this.settings.soundEnabled,document.getElementById("soundscapeSelect").value=this.settings.soundscape,document.getElementById("tickingClockEnabled").checked=this.settings.tickingEnabled,["goal1","goal2","goal3"].forEach((e,t)=>{document.getElementById(e).value=this.settings.goals[t]||""})}async saveSettingsFromModal(){this.settings.theme=document.getElementById("themeSelect").value,this.settings.fontSize=parseInt(document.getElementById("fontSizeSlider").value,10),this.settings.animationSpeed=document.getElementById("animationSpeed").value,this.settings.focusDuration=parseInt(document.getElementById("focusDuration").value,10),this.settings.shortBreakDuration=parseInt(document.getElementById("shortBreakDuration").value,10),this.settings.longBreakDuration=parseInt(document.getElementById("longBreakDuration").value,10),this.settings.sessionsPerCycle=parseInt(document.getElementById("sessionsPerCycle").value,10),this.settings.achievementsEnabled=document.getElementById("achievementsEnabled").checked,this.settings.soundEnabled=document.getElementById("soundEnabled").checked,this.settings.soundscape=document.getElementById("soundscapeSelect").value,this.settings.tickingEnabled=document.getElementById("tickingClockEnabled").checked,this.settings.goals=[...new Set(["goal1","goal2","goal3"].map(e=>document.getElementById(e).value.trim()).filter(Boolean))].slice(0,3),await this.saveSettings(),this.applySettings(),this.closeSettings(),this.showFeedback("Settings saved!","success")}playSound(e){this.audioManager.playSound(e)}get isOnline(){return navigator.onLine&&!!this.user}async loadTasks(){if(this.isOnline){const{data:e,error:t}=await De.from("tasks").select("*").eq("user_id",this.user.id).order("created_at");if(t){this.tasks=JSON.parse(localStorage.getItem("focusmatrix_ultimate_tasks")||"[]");return}this.tasks=(e||[]).map(s=>({id:`task_${s.id}`,database_id:s.id,text:s.text,quadrant:s.quadrant,goal:s.goal||null,created_at:s.created_at}))}else this.tasks=JSON.parse(localStorage.getItem("focusmatrix_ultimate_tasks")||"[]")}async saveTasks(){if(this.isOnline){const e=this.tasks.filter(s=>!s.database_id),t=this.tasks.filter(s=>s.database_id);if(e.length>0){const s=e.map(o=>({user_id:this.user.id,text:o.text,quadrant:o.quadrant,goal:o.goal,created_at:o.created_at,updated_at:new Date().toISOString()})),{data:i,error:r}=await De.from("tasks").insert(s).select();!r&&i&&i.forEach((o,a)=>{const c=e[a];c&&(c.database_id=o.id)})}if(t.length>0){const s=t.map(i=>({id:i.database_id,user_id:this.user.id,text:i.text,quadrant:i.quadrant,goal:i.goal,updated_at:new Date().toISOString()}));await De.from("tasks").upsert(s)}}localStorage.setItem("focusmatrix_ultimate_tasks",JSON.stringify(this.tasks))}async loadSettings(){var t;const e=this.settings;if(this.isOnline)try{const{data:s,error:i}=await De.from("settings").select("data").eq("user_id",(t=this.user)==null?void 0:t.id).single();i&&i.code!=="PGRST116"&&console.error("Error loading settings:",i);const r=(s==null?void 0:s.data)||{},o=JSON.parse(localStorage.getItem("focusmatrix_ultimate_settings")||"{}");this.settings={...e,...r,...o}}catch{this.settings={...e,...JSON.parse(localStorage.getItem("focusmatrix_ultimate_settings")||"{}")}}else this.settings={...e,...JSON.parse(localStorage.getItem("focusmatrix_ultimate_settings")||"{}")}}async saveSettings(){this.isOnline&&await De.from("settings").upsert({user_id:this.user.id,data:this.settings}),localStorage.setItem("focusmatrix_ultimate_settings",JSON.stringify(this.settings)),this.updateGoalSelect()}async loadStats(){const e=new Date().toISOString().split("T")[0];if(this.isOnline){const{data:t,error:s}=await De.from("daily_stats").select("*").eq("user_id",this.user.id).eq("day",e).single();s&&s.code!=="PGRST116"&&console.error("Error loading stats:",s),t?this.stats={...this.stats,...t,tasksAddedToday:t.tasks_added||0,tasksCompletedToday:t.tasks_completed||0,tasksEliminatedToday:t.tasks_eliminated||0,focusSessionsToday:t.focus_sessions||0,lastUsedDate:e,day:e}:(this.stats.tasksAddedToday=0,this.stats.tasksCompletedToday=0,this.stats.tasksEliminatedToday=0,this.stats.focusSessionsToday=0,this.stats.lastUsedDate=e,this.stats.day=e)}else this.stats=JSON.parse(localStorage.getItem("focusmatrix_ultimate_stats")||"{}")||{...this.stats},this.stats.day!==e&&(this.stats={...this.stats,day:e})}async saveStats(){if(this.isOnline){const e=new Date().toISOString().split("T")[0];await De.from("daily_stats").upsert({user_id:this.user.id,day:e,tasks_added:this.stats.tasksAddedToday||0,tasks_completed:this.stats.tasksCompletedToday||0,tasks_eliminated:this.stats.tasksEliminatedToday||0,focus_sessions:this.stats.focusSessionsToday||0},{onConflict:"user_id,day"})}localStorage.setItem("focusmatrix_ultimate_stats",JSON.stringify(this.stats))}bindSettingsEvents(){["settingsOverlay","closeSettings","cancelSettings"].forEach(e=>document.getElementById(e).addEventListener("click",()=>this.closeSettings())),document.getElementById("saveSettings").addEventListener("click",()=>this.saveSettingsFromModal()),document.getElementById("resetSettings").addEventListener("click",()=>this.resetSettings()),document.getElementById("fontSizeSlider").addEventListener("input",e=>document.getElementById("fontSizeValue").textContent=e.target.value+"px")}updateGoalSelect(){const e=document.getElementById("goalSelect");if(!e)return;e.innerHTML="";const t=document.createElement("option");t.value="",t.textContent="No goal",e.appendChild(t),this.settings.goals.forEach(s=>{const i=document.createElement("option");i.value=s,i.textContent=s,e.appendChild(i)}),e.style.display=this.settings.goals.length?"block":"none"}async handleAddTask(){var r;const e=document.getElementById("taskInput"),t=e.value.trim();if(!t){this.showFeedback("Please enter a task","error");return}const s=((r=document.getElementById("goalSelect"))==null?void 0:r.value)||null,i={id:`task_${Date.now()}`,text:this.sanitizeText(t),quadrant:1,goal:s,created_at:new Date().toISOString()};this.tasks.push(i),await this.saveTasks(),this.stats.tasksAddedToday++,await this.saveStats(),this.renderTask(i),this.updateDashboard(),e.value="",e.focus()}handleDragOver(e){e.preventDefault()}handleDragEnter(e){var t;(t=e.target.closest(".task-list"))==null||t.classList.add("drag-over")}handleDragLeave(e){var t;(t=e.target.closest(".task-list"))==null||t.classList.remove("drag-over")}async handleDrop(e){e.preventDefault();const t=e.target.closest(".task-list");if(!t||!this.draggedTask)return;const s=parseInt(t.closest(".quadrant").dataset.quadrant);this.draggedTask.quadrant!==s&&(this.draggedTask.quadrant=s,await this.saveTasks(),this.renderAllTasks(),s===4&&this.handleQuadrant4(this.draggedTask))}handleTouchStart(e){this.touchStartX=e.touches[0].clientX,this.touchStartY=e.touches[0].clientY,this.touchStartTime=Date.now()}handleTouchMove(e,t){const s=e.touches[0].clientX-this.touchStartX;Math.abs(s)<10||(t.style.transform=`translateX(${s}px)`,s<-this.swipeThreshold?t.classList.add("swipe-left"):t.classList.remove("swipe-left"))}handleTouchEnd(e,t,s){const i=e.changedTouches[0].clientX-this.touchStartX,r=e.changedTouches[0].clientY-this.touchStartY,o=Date.now()-this.touchStartTime;if(s.style.transform="",s.classList.remove("swipe-left"),o<this.tapThreshold&&Math.abs(i)<10&&Math.abs(r)<10){this.editTask(t);return}i<-this.swipeThreshold&&this.deleteTask(t.id,!0)}updateEmptyStates(){document.querySelectorAll(".quadrant").forEach(e=>{const t=e.querySelector(".task-list");let s=e.querySelector(".empty-state");t.children.length?s==null||s.remove():s||(s=document.createElement("div"),s.className="empty-state",s.textContent="Drag tasks here",t.appendChild(s))})}renderAllTasks(){document.querySelectorAll(".task-list").forEach(e=>e.innerHTML=""),this.tasks.forEach(e=>this.renderTask(e)),this.updateEmptyStates()}bindTimerEvents(){document.getElementById("startTimer").addEventListener("click",()=>this.startTimer()),document.getElementById("pauseTimer").addEventListener("click",()=>this.pauseTimer()),document.getElementById("resetTimer").addEventListener("click",()=>this.resetTimer()),document.getElementById("exitFocus").addEventListener("click",()=>this.toggleFocusMode()),document.getElementById("phaseFocus").addEventListener("click",()=>this.setTimerMode("focus")),document.getElementById("phaseShortBreak").addEventListener("click",()=>this.setTimerMode("shortBreak")),document.getElementById("phaseLongBreak").addEventListener("click",()=>this.setTimerMode("longBreak"))}resetTimer(){this.pauseTimer(),this.currentCycle=1,this.setTimerMode("focus",!0)}updateTimerDisplay(){const e=String(Math.floor(this.timeRemaining/60)).padStart(2,"0"),t=String(this.timeRemaining%60).padStart(2,"0");document.getElementById("timerDisplay").textContent=`${e}:${t}`}setTimerMode(e,t=!1){if(!t&&this.timerRunning&&!confirm("A timer is running. Are you sure you want to switch?"))return;this.pauseTimer(),this.timerMode=e;const s=document.getElementById("timerDisplay"),i=document.getElementById("timerSessionTitle"),r=document.getElementById("timerSessionCount");switch(document.querySelectorAll(".phase-btn").forEach(o=>o.classList.remove("active")),e){case"focus":this.timeRemaining=this.settings.focusDuration*60,s.classList.remove("break-mode"),s.classList.add("focus-mode"),document.getElementById("phaseFocus").classList.add("active"),i.textContent="Time to Focus!",r.textContent=`Session ${this.currentCycle} of ${this.settings.sessionsPerCycle}`;break;case"shortBreak":this.timeRemaining=this.settings.shortBreakDuration*60,s.classList.remove("focus-mode"),s.classList.add("break-mode"),document.getElementById("phaseShortBreak").classList.add("active"),i.textContent="Short Break",r.textContent="Relax and recharge";break;case"longBreak":this.timeRemaining=this.settings.longBreakDuration*60,s.classList.remove("focus-mode"),s.classList.add("break-mode"),document.getElementById("phaseLongBreak").classList.add("active"),i.textContent="Long Break",r.textContent="Take a well-deserved rest";break}this.updateTimerDisplay()}toggleProgressDashboard(){this.progressMode=!this.progressMode,document.getElementById("progressDashboard").style.display=this.progressMode?"block":"none",document.getElementById("progressToggle").classList.toggle("active",this.progressMode),this.progressMode&&this.updateDashboard()}openSettings(){this.populateSettingsModal(),document.getElementById("settingsModal").classList.add("show")}closeSettings(){document.getElementById("settingsModal").classList.remove("show")}resetSettings(){confirm("Reset settings to defaults?")&&(localStorage.removeItem("focusmatrix_ultimate_settings"),window.location.reload())}updateDashboard(){document.getElementById("tasksAddedToday").textContent=this.stats.tasksAddedToday,document.getElementById("tasksCompletedToday").textContent=this.stats.tasksCompletedToday,document.getElementById("focusSessionsToday").textContent=this.stats.focusSessionsToday,document.getElementById("tasksEliminatedToday").textContent=this.stats.tasksEliminatedToday,document.getElementById("dailyStreak").textContent=`${this.stats.dailyStreak} days`,document.getElementById("focusStreak").textContent=`${this.stats.focusStreak} days`,document.getElementById("eliminationStreak").textContent=`${this.stats.totalEliminated} total`}checkDailyReset(){const e=new Date().toDateString();this.stats.lastUsedDate!==e&&(this.stats.tasksAddedToday=0,this.stats.tasksCompletedToday=0,this.stats.tasksEliminatedToday=0,this.stats.focusSessionsToday=0,this.stats.lastUsedDate=e,this.saveStats())}checkAchievements(){!this.stats.achievements.firstStep&&this.stats.totalEliminated>0&&(this.stats.achievements.firstStep=!0,this.showFeedback("Achievement unlocked: First Step!","achievement")),!this.stats.achievements.focusStarter&&this.stats.focusSessionsToday>0&&(this.stats.achievements.focusStarter=!0,this.showFeedback("Achievement unlocked: Focus Starter!","achievement")),this.saveStats()}quickExport(){this.exportAllData(!0)}exportAllData(e=!1){const t={tasks:this.tasks,stats:this.stats,settings:this.settings,ts:new Date().toISOString(),v:"cloud-goals-2.1"},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download=`focusmatrix-${t.ts.split("T")[0]}.json`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(i),e&&this.showFeedback("Data exported!","success")}handleFileImport(e){const t=e.target.files[0];if(!t)return;const s=new FileReader;s.onload=async i=>{try{const r=JSON.parse(i.target.result);if(r.tasks&&r.stats&&r.settings)this.tasks=r.tasks,this.stats=r.stats,this.settings=r.settings,await this.saveTasks(),await this.saveStats(),await this.saveSettings(),this.applySettings(),this.renderAllTasks(),this.updateDashboard(),this.showFeedback("Import complete!","success");else throw new Error}catch{this.showFeedback("Invalid import file","error")}},s.readAsText(t),e.target.value=""}bindDataManagementEvents(){document.getElementById("exportDataBtn").addEventListener("click",()=>this.exportAllData()),document.getElementById("importDataBtn").addEventListener("click",()=>document.getElementById("importDataInput").click()),document.getElementById("clearAllDataBtn").addEventListener("click",()=>this.clearAllData()),document.getElementById("importDataInput").addEventListener("change",e=>this.handleFileImport(e))}clearAllData(){confirm("Delete all local data?")&&(localStorage.clear(),location.reload())}sanitizeText(e){return e.replace(/[<>]/g,"").trim()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}showFeedback(e,t="info"){const s=document.createElement("div");s.className=`feedback-message ${t}`,s.textContent=e,document.body.appendChild(s),setTimeout(()=>s.remove(),3e3)}handleKeyboard(e){}setupAccessibility(){}requestNotificationPermission(){"Notification"in window&&Notification.permission!=="granted"&&Notification.permission!=="denied"&&Notification.requestPermission().then(e=>{e==="granted"&&this.showFeedback("Notifications enabled!","success")})}announceToScreenReader(){}editTask(e){const t=document.querySelector(`[data-task-id="${e.id}"]`);if(!t)return;const s=t.querySelector(".task-text"),i=e.text,r=document.createElement("input");r.type="text",r.value=i,r.className="task-edit-input",r.maxLength=200,s.innerHTML="",s.appendChild(r),r.focus(),r.select();const o=async()=>{const c=this.sanitizeText(r.value.trim());c&&c!==i&&(e.text=c,await this.saveTasks(),this.showFeedback("Task updated!","success")),this.renderAllTasks()},a=()=>{this.renderAllTasks()};r.addEventListener("blur",o),r.addEventListener("keydown",c=>{c.key==="Enter"?(c.preventDefault(),o()):c.key==="Escape"&&(c.preventDefault(),a())})}handleQuadrant4(e){setTimeout(()=>{confirm(`Let go of "${e.text}"?`)&&this.deleteTask(e.id)},300)}async deleteTask(e,t=!1){const s=this.tasks.findIndex(a=>a.id===e);if(s===-1)return;const i=this.tasks[s],r=document.querySelector(`[data-task-id="${e}"]`),o=async()=>{this.isOnline&&i.database_id&&await De.from("tasks").delete().eq("id",i.database_id),this.tasks.splice(s,1),i.quadrant===4?(this.stats.tasksEliminatedToday++,this.stats.totalEliminated++):this.stats.tasksCompletedToday++,localStorage.setItem("focusmatrix_ultimate_tasks",JSON.stringify(this.tasks)),await this.saveStats(),this.updateDashboard(),this.checkAchievements()};r&&!t?(r.classList.add("completing"),setTimeout(()=>{r.remove(),o()},500)):(r==null||r.remove(),o())}}document.addEventListener("DOMContentLoaded",()=>{window.focusMatrix=new ng;const n=document.getElementById("burger"),e=document.getElementById("mobileNav");n&&e&&(n.addEventListener("click",()=>{const t=n.getAttribute("aria-expanded")==="true";n.setAttribute("aria-expanded",String(!t)),e.classList.toggle("is-open"),e.setAttribute("aria-hidden",String(t))}),e.querySelectorAll(".mobile-item").forEach(t=>{t.addEventListener("click",()=>{n.setAttribute("aria-expanded","false"),e.classList.remove("is-open"),e.setAttribute("aria-hidden","true")})}))});export{ko as W};
